LavaPack.loadBundle([[888,{"../../services/ledger/erc20":894,"../../services/ledger/loadConfig":896,"../../utils":898,"./utils":889,"@ledgerhq/evm-tools/lib/message/EIP712/index":882,buffer:4106,semver:5627},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function o(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.signEIP712HashedMessage=r.signEIP712Message=void 0;const i=s(e("semver")),a=e("@ledgerhq/evm-tools/lib/message/EIP712/index"),o=e("../../services/ledger/erc20"),c=e("../../utils"),l=e("../../services/ledger/loadConfig"),d=e("./utils"),u=(e,r)=>{let n;!function(e){e[e.CLA=224]="CLA",e[e.INS=26]="INS",e[e.P1_complete=0]="P1_complete",e[e.P1_partial=1]="P1_partial",e[e.P2_name=0]="P2_name",e[e.P2_field=255]="P2_field"}(n||(n={}));const{structType:s,value:i}=r,a="name"===s&&"string"==typeof i?t.from(i,"utf-8"):i;return e.send(n.CLA,n.INS,n.P1_complete,"name"===s?n.P2_name:n.P2_field,a)},f=(e,r)=>n(void 0,void 0,void 0,(function*(){var n;let s;!function(e){e[e.CLA=224]="CLA",e[e.INS=28]="INS",e[e.P1_complete=0]="P1_complete",e[e.P1_partial=1]="P1_partial",e[e.P2_root=0]="P2_root",e[e.P2_array=15]="P2_array",e[e.P2_field=255]="P2_field"}(s||(s={}));const{structType:i,value:a}=r;if("root"===i)return e.send(s.CLA,s.INS,s.P1_complete,s.P2_root,t.from(a,"utf-8"));if("array"===i)return e.send(s.CLA,s.INS,s.P1_complete,s.P2_array,t.from((0,c.intAsHexBytes)(a,1),"hex"));if("field"===i){const{data:r,type:i,sizeInBits:o}=a,l=null===(n=d.EIP712_TYPE_ENCODERS[i.toUpperCase()])||void 0===n?void 0:n.call(d.EIP712_TYPE_ENCODERS,r,o);if(l){const r=Math.floor(l.length/256),n=l.length%256,i=t.concat([t.from((0,c.intAsHexBytes)(r,1),"hex"),t.from((0,c.intAsHexBytes)(n,1),"hex"),l]),a=new Array(Math.ceil(i.length/256)).fill(null).map(((e,t)=>i.subarray(255*t,255*(t+1))));for(const t of a)yield e.send(s.CLA,s.INS,t!==a[a.length-1]?s.P1_partial:s.P1_complete,s.P2_field,t)}}return Promise.resolve()}));function p(e,r,s,i){return n(this,void 0,void 0,(function*(){let n;switch(function(e){e[e.CLA=224]="CLA",e[e.INS=30]="INS",e[e.P1_standard=0]="P1_standard",e[e.P1_discarded=1]="P1_discarded",e[e.P2_activate=0]="P2_activate",e[e.P2_discarded=1]="P2_discarded",e[e.P2_show_field=255]="P2_show_field",e[e.P2_message_info=15]="P2_message_info",e[e.P2_datetime=252]="P2_datetime",e[e.P2_amount_join_token=253]="P2_amount_join_token",e[e.P2_amount_join_value=254]="P2_amount_join_value",e[e.P2_raw=255]="P2_raw"}(n||(n={})),r){case"activate":return e.send(n.CLA,n.INS,n.P1_discarded,n.P2_activate);case"contractName":{const{displayName:r,filtersCount:s,sig:a}=i,{displayNameBuffer:o,sigBuffer:l}=(0,d.getFilterDisplayNameAndSigBuffers)(r,a),u=t.from((0,c.intAsHexBytes)(s,1),"hex"),f=t.concat([o,u,l]);return e.send(n.CLA,n.INS,n.P1_standard,n.P2_message_info,f)}case"showField":{const{displayName:r,sig:s,format:a,coinRef:c,chainId:l,coinRefsTokensMap:u,shouldUseV1Filters:f,erc20SignaturesBlob:p,isDiscarded:h}=i,{displayNameBuffer:g,sigBuffer:m}=(0,d.getFilterDisplayNameAndSigBuffers)(r,s);if(f){const r=t.concat([g,m]);return e.send(n.CLA,n.INS,n.P1_standard,n.P2_show_field,r)}if("token"===a&&c!==undefined){const{token:t,deviceTokenIndex:r}=u[c];if(r===undefined){const r=yield(0,o.byContractAddressAndChainId)(t,l,p);if(r){let t;!function(e){e[e.CLA=224]="CLA",e[e.INS=10]="INS",e[e.P1=0]="P1",e[e.P2=0]="P2"}(t||(t={}));const n=yield e.send(t.CLA,t.INS,t.P1,t.P2,r.data);u[c].deviceTokenIndex=n[0]}}}if("amount"===a&&255===c){const{token:t}=u[255],r=yield(0,o.byContractAddressAndChainId)(t,l,p);r&&(yield e.send(224,10,0,0,r.data),u[255].deviceTokenIndex=255)}if(!a)throw new Error("Missing format");const E={raw:n.P2_raw,datetime:n.P2_datetime,token:n.P2_amount_join_token,amount:n.P2_amount_join_value},_=(0,d.getPayloadForFilterV2)(a,c,u,g,m);return e.send(n.CLA,n.INS,h?n.P1_discarded:n.P1_standard,E[a],_)}case"discardField":{const{path:r}=i,s=t.from(r),a=t.from((0,c.intAsHexBytes)(s.length,1),"hex"),o=t.concat([a,s]);return e.send(n.CLA,n.INS,n.P1_standard,n.P2_discarded,o)}}}))}r.signEIP712Message=(e,r,s,...h)=>n(void 0,[e,r,s,...h],void 0,(function*(e,r,s,h=!1,g){let m;!function(e){e[e.CLA=224]="CLA",e[e.INS=12]="INS",e[e.P1=0]="P1",e[e.P2_v0=0]="P2_v0",e[e.P2_full=1]="P2_full"}(m||(m={}));const{primaryType:E,types:_,domain:v,message:y}=s,{calServiceURL:T}=(0,l.getLoadConfig)(g),A=(0,a.sortObjectAlphabetically)(_),{version:I}=yield(0,d.getAppAndVersion)(e),b=!i.default.gte(I,"1.11.1-0",{includePrerelease:!0}),P=i.default.gte(I,"1.12.0-0",{includePrerelease:!0}),S=yield(0,a.getFiltersForMessage)(s,b,T),C=(0,d.getCoinRefTokensMap)(S,b,s),M=Object.entries(A);for(const[t,r]of M){yield u(e,{structType:"name",value:t});for(const{name:t,type:n}of r){const r=(0,d.makeTypeEntryStructBuffer)({name:t,type:n});yield u(e,{structType:"field",value:r})}}S&&(yield p(e,"activate"));const w=b?undefined:yield(0,o.findERC20SignaturesInfo)(g,v.chainId||0),N=(({transport:e,loadConfig:t,chainId:r,erc20SignaturesBlob:s,types:i,filters:a,shouldUseV1Filters:o,shouldUseDiscardedFields:c,coinRefsTokensMap:l})=>{var u;const h={};for(const e in i)h[e]=null===(u=i[e])||void 0===u?void 0:u.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.name]:t.type})),{});const g=(t,i,...u)=>n(void 0,[t,i,...u],void 0,(function*(t,n,i=""){var u,m;const[E,_]=t,[v,...y]=_,T=!d.EIP712_TYPE_PROPERTIES[(null===(u=null==E?void 0:E.name)||void 0===u?void 0:u.toUpperCase())||""];if(Array.isArray(n)&&void 0!==v){yield f(e,{structType:"array",value:n.length});const t=`${i}.[]`;if(!n.length){const n=null==a?void 0:a.fields.filter((e=>e.path.startsWith(t)));if(n&&c)for(const t of n)yield p(e,"discardField",0,{path:t.path}),yield p(e,"showField",0,{displayName:t.label,sig:t.signature,format:t.format,coinRef:t.coin_ref,chainId:r,erc20SignaturesBlob:s,shouldUseV1Filters:o,coinRefsTokensMap:l,isDiscarded:!0})}for(const e of n)yield g([E,y],e,t)}else if(T)for(const e of Object.keys(h[(null==E?void 0:E.name)||""])){const t=n[e],r=null===(m=h[(null==E?void 0:E.name)||""])||void 0===m?void 0:m[e];r&&(yield g((0,d.destructTypeFromString)(r),t,`${i}.${e}`))}else{const t=null==a?void 0:a.fields.find((e=>i===e.path));t&&(yield p(e,"showField",0,{displayName:t.label,sig:t.signature,format:t.format,coinRef:t.coin_ref,chainId:r,erc20SignaturesBlob:s,shouldUseV1Filters:o,coinRefsTokensMap:l,isDiscarded:!1})),yield f(e,{structType:"field",value:{data:n,type:(null==E?void 0:E.name)||"",sizeInBits:null==E?void 0:E.size}})}}));return g})({transport:e,loadConfig:g,chainId:v.chainId||0,erc20SignaturesBlob:w,types:A,filters:S,shouldUseV1Filters:b,shouldUseDiscardedFields:P,coinRefsTokensMap:C}),O="EIP712Domain";yield f(e,{structType:"root",value:O});const R=A[O];for(const{name:e,type:t}of R){const r=v[e];yield N((0,d.destructTypeFromString)(t),r)}if(S){const{contractName:t,fields:r}=S,n={displayName:t.label,filtersCount:r.length,sig:t.signature};yield p(e,"contractName",0,n)}yield f(e,{structType:"root",value:E});const k=A[E];for(const{name:e,type:t}of k){const r=y[e];yield N((0,d.destructTypeFromString)(t),r,e)}const L=(0,c.splitPath)(r),x=t.alloc(1+4*L.length);return x[0]=L.length,L.forEach(((e,t)=>{x.writeUInt32BE(e,1+4*t)})),e.send(m.CLA,m.INS,m.P1,h?m.P2_v0:m.P2_full,x).then((e=>({v:e[0],r:e.subarray(1,33).toString("hex"),s:e.subarray(33,65).toString("hex")})))}));r.signEIP712HashedMessage=(e,r,n,s)=>{const i=(0,c.hexBuffer)(n),a=(0,c.hexBuffer)(s),o=(0,c.splitPath)(r),l=t.alloc(1+4*o.length+32+32,0);let d=0;return l[0]=o.length,o.forEach(((e,t)=>{l.writeUInt32BE(e,1+4*t)})),d=1+4*o.length,i.copy(l,d),d+=32,a.copy(l,d),e.send(224,12,0,0,l).then((e=>({v:e[0],r:e.subarray(1,33).toString("hex"),s:e.subarray(33,65).toString("hex")})))}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/modules/EIP712/index.js"}],[889,{"../../utils":898,"@ledgerhq/evm-tools/lib/message/index":883,"bignumber.js":899,buffer:4106},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function o(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.getPayloadForFilterV2=r.getFilterDisplayNameAndSigBuffers=r.getAppAndVersion=r.getCoinRefTokensMap=r.makeTypeEntryStructBuffer=r.constructTypeDescByteString=r.destructTypeFromString=r.EIP712_TYPE_ENCODERS=r.EIP712_TYPE_PROPERTIES=void 0;const i=s(e("bignumber.js")),a=e("@ledgerhq/evm-tools/lib/message/index"),o=e("../../utils");var c;!function(e){e[e.DYNAMIC=0]="DYNAMIC",e[e.FIXED=1]="FIXED"}(c||(c={})),r.EIP712_TYPE_PROPERTIES={CUSTOM:{key:()=>0,size:()=>null},INT:{key:()=>1,size:e=>Number(e)/8},UINT:{key:()=>2,size:e=>Number(e)/8},ADDRESS:{key:()=>3,size:()=>null},BOOL:{key:()=>4,size:()=>null},STRING:{key:()=>5,size:()=>null},BYTES:{key:e=>void 0!==e?6:7,size:e=>void 0!==e?Number(e):null}},r.EIP712_TYPE_ENCODERS={INT(e,r=256){const n=null!=e?e:"0";if("string"==typeof n&&(null==n?void 0:n.startsWith("0x")))return(0,o.hexBuffer)(n);let s=new i.default(n);if(s.lt(0)){const e=r/8;s=new i.default(`0x${t.alloc(e,255).toString("hex")}`).plus(s).plus(1)}const a=s.toString(16).length%2?"0"+s.toString(16):s.toString(16);return t.from(a,"hex")},UINT(e){return this.INT(e)},BOOL(e){return this.INT("boolean"==typeof e?Number(e).toString():e)},ADDRESS:e=>(0,o.hexBuffer)(null!=e?e:"").slice(0,20),STRING:e=>t.from(null!=e?e:"","utf-8"),BYTES(e,t){const r=null!=e?e:"";return(0,o.hexBuffer)(r).slice(0,null!=t?t:((null==r?void 0:r.length)-2)/2)}};r.destructTypeFromString=e=>{const t=new RegExp(/^([^[\]]*)(\[.*\])*/g),r=new RegExp(/\[(\d*)\]/g),n=new RegExp(/(?=u?int|bytes)([a-zA-Z-0-9]+?)(\d{1,3})$/g),[,s,i]=t.exec(e||"")||[],[,a=s,o]=n.exec(s||"")||[];return[a?{name:a,size:o?Number(o):undefined}:null,(i?[...i.matchAll(r)]:[]).map((([,e])=>e?Number(e):null))]};r.constructTypeDescByteString=(e,t,r)=>{if(r>=16)throw new Error("Eth utils - constructTypeDescByteString - Cannot accept a typeValue >= 16 because the typeValue can only be 4 bits in binary"+{isArray:e,typeSize:t,typeValue:r});const n=e?"1":"0",s="number"==typeof t?"1":"0",i=r.toString(2).padStart(4,"0");return(0,o.intAsHexBytes)(parseInt(n+s+"00"+i,2),1)};r.makeTypeEntryStructBuffer=({name:e,type:n})=>{var s,i,a,l;const[d,u]=(0,r.destructTypeFromString)(n),f=Boolean(u.length),p=r.EIP712_TYPE_PROPERTIES[(null===(s=null==d?void 0:d.name)||void 0===s?void 0:s.toUpperCase())||""]||r.EIP712_TYPE_PROPERTIES.CUSTOM,h=p.key(null==d?void 0:d.size),g=p.size(null==d?void 0:d.size),m=(0,r.constructTypeDescByteString)(f,g,h),E=[t.from(m,"hex")];return p===r.EIP712_TYPE_PROPERTIES.CUSTOM&&(E.push(t.from((0,o.intAsHexBytes)(null!==(a=null===(i=null==d?void 0:d.name)||void 0===i?void 0:i.length)&&void 0!==a?a:0,1),"hex")),E.push(t.from(null!==(l=null==d?void 0:d.name)&&void 0!==l?l:"","utf-8"))),"number"==typeof g&&E.push(t.from((0,o.intAsHexBytes)(g,1),"hex")),f&&(E.push(t.from((0,o.intAsHexBytes)(u.length,1),"hex")),u.forEach((e=>{"number"==typeof e?E.push(t.from((0,o.intAsHexBytes)(c.FIXED,1),"hex"),t.from((0,o.intAsHexBytes)(e,1),"hex")):E.push(t.from((0,o.intAsHexBytes)(c.DYNAMIC,1),"hex"))}))),E.push(t.from((0,o.intAsHexBytes)(e.length,1),"hex"),t.from(e,"utf-8")),t.concat(E)};r.getCoinRefTokensMap=(e,t,r)=>{const n={};if(t||!e)return n;const s=e.fields.filter((({format:e})=>"token"===e)).sort(((e,t)=>(e.coin_ref||0)-(t.coin_ref||0))).reduce(((e,t)=>{const n=(0,a.getValueFromPath)(t.path,r);if(Array.isArray(n))throw new Error("Array of tokens is not supported with a single coin ref");return[...e,{token:n,coinRef:t.coin_ref}]}),[]);for(const{token:e,coinRef:t}of s)n[t]={token:e};return e.fields.some((e=>"amount"===e.format&&255===e.coin_ref))&&r.domain.verifyingContract&&(n[255]={token:r.domain.verifyingContract}),n};r.getAppAndVersion=e=>n(void 0,void 0,void 0,(function*(){const t=yield e.send(176,1,0,0);let r=1;const n=t[r];r+=1;const s=t.subarray(r,r+n).toString("ascii");r+=n;const i=t[r];r+=1;return{name:s,version:t.subarray(r,r+i).toString("ascii")}}));r.getFilterDisplayNameAndSigBuffers=(e,r)=>{const n=t.from(e),s=t.from((0,o.intAsHexBytes)(n.length,1),"hex"),i=t.from(r,"hex"),a=t.from((0,o.intAsHexBytes)(i.length,1),"hex");return{displayNameBuffer:t.concat([s,n]),sigBuffer:t.concat([a,i])}};r.getPayloadForFilterV2=(e,r,n,s,i)=>{switch(e){case"raw":case"datetime":return t.concat([s,i]);case"token":{const{deviceTokenIndex:e}=n[r];return t.concat([t.from((0,o.intAsHexBytes)(e||r||0,1),"hex"),i])}case"amount":{const{deviceTokenIndex:e}=n[r];return t.concat([s,t.from((0,o.intAsHexBytes)(e||r||0,1),"hex"),i])}default:throw new Error("Invalid format")}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/modules/EIP712/utils.js"}],[89,{"../../../shared/constants/app":5798,"../../../shared/constants/keyring":5807,"../../../shared/constants/metametrics":5810,"@metamask/base-controller":1476,"@metamask/message-manager":2174,loglevel:4920},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,s=(n=e("loglevel"))&&n.__esModule?n:{default:n},i=e("@metamask/message-manager"),a=e("@metamask/base-controller"),o=e("../../../shared/constants/metametrics"),c=e("../../../shared/constants/keyring"),l=e("../../../shared/constants/app");function d(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const u="EncryptionPublicKeyManager",f={unapprovedEncryptionPublicKeyMsgs:{persist:!1,anonymous:!1},unapprovedEncryptionPublicKeyMsgCount:{persist:!1,anonymous:!1}};class p extends a.BaseController{constructor({messenger:e,managerMessenger:t,getEncryptionPublicKey:r,getAccountKeyringType:n,getState:s,metricsEvent:a}){super({name:"EncryptionPublicKeyController",metadata:f,messenger:e,state:{unapprovedEncryptionPublicKeyMsgs:{},unapprovedEncryptionPublicKeyMsgCount:0}}),d(this,"_getEncryptionPublicKey",void 0),d(this,"_getAccountKeyringType",void 0),d(this,"_getState",void 0),d(this,"_encryptionPublicKeyManager",void 0),d(this,"_metricsEvent",void 0),this._getEncryptionPublicKey=r,this._getAccountKeyringType=n,this._getState=s,this._metricsEvent=a,this._encryptionPublicKeyManager=new i.EncryptionPublicKeyManager({additionalFinishStatuses:["received"],messenger:t}),this.messagingSystem.subscribe(`${u}:unapprovedMessage`,this._requestApproval.bind(this)),this._subscribeToMessageState(e,((e,t,r)=>{e.unapprovedEncryptionPublicKeyMsgs=t,e.unapprovedEncryptionPublicKeyMsgCount=r}))}get unapprovedMsgCount(){return this._encryptionPublicKeyManager.getUnapprovedMessagesCount()}resetState(){this.update((()=>({unapprovedEncryptionPublicKeyMsgs:{},unapprovedEncryptionPublicKeyMsgCount:0})))}async newRequestEncryptionPublicKey(e,t){switch(await this._getAccountKeyringType(e)){case c.KeyringType.ledger:return new Promise(((e,t)=>{t(new Error("Ledger does not support eth_getEncryptionPublicKey."))}));case c.KeyringType.trezor:return new Promise(((e,t)=>{t(new Error("Trezor does not support eth_getEncryptionPublicKey."))}));case c.KeyringType.lattice:return new Promise(((e,t)=>{t(new Error("Lattice does not support eth_getEncryptionPublicKey."))}));case c.KeyringType.qr:return Promise.reject(new Error("QR hardware does not support eth_getEncryptionPublicKey."));default:return this._encryptionPublicKeyManager.addUnapprovedMessageAsync({from:e},t)}}async encryptionPublicKey(e){s.default.info("MetaMaskController - encryptionPublicKey");const t=e.metamaskId;try{const r=await this._encryptionPublicKeyManager.approveMessage(e),n=await this._getEncryptionPublicKey(r.from);return this._encryptionPublicKeyManager.setMessageStatusAndResult(t,n,"received"),this._acceptApproval(t),this._getState()}catch(e){throw s.default.info("MetaMaskController - eth_getEncryptionPublicKey failed.",e),this._cancelAbstractMessage(this._encryptionPublicKeyManager,t),e}}cancelEncryptionPublicKey(e){return this._cancelAbstractMessage(this._encryptionPublicKeyManager,e)}rejectUnapproved(e){Object.keys(this._encryptionPublicKeyManager.getUnapprovedMessages()).forEach((t=>{this._cancelAbstractMessage(this._encryptionPublicKeyManager,t,e)}))}clearUnapproved(){this._encryptionPublicKeyManager.clearUnapprovedMessages()}_cancelAbstractMessage(e,t,r){return r&&this._metricsEvent({event:r,category:o.MetaMetricsEventCategory.Messages,properties:{action:"Encryption public key Request"}}),e.rejectMessage(t),this._rejectApproval(t),this._getState()}_subscribeToMessageState(e,t){e.subscribe(`${u}:stateChange`,(e=>{const r=this._migrateMessages(e.unapprovedMessages);this.update((n=>{t(n,r,e.unapprovedMessagesCount)}))}))}_migrateMessages(e){const t={};for(const r of Object.keys(e)){const n=e[r],s=this._migrateMessage(n);t[r]=s}return t}_migrateMessage(e){const{messageParams:t,...r}=e;return{...r,rawSig:e.rawSig,msgParams:t.from,origin:t.origin}}_requestApproval(e){const t=e.metamaskId,r=e.origin||l.ORIGIN_METAMASK;this.messagingSystem.call("ApprovalController:addRequest",{id:t,origin:r,type:"eth_getEncryptionPublicKey"},!0).catch((()=>{}))}_acceptApproval(e){this.messagingSystem.call("ApprovalController:acceptRequest",e)}_rejectApproval(e){this.messagingSystem.call("ApprovalController:rejectRequest",e,"Cancel")}}r.default=p}}},{package:"$root$",file:"app/scripts/controllers/encryption-public-key.ts"}],[890,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.SWAP_COMMANDS=r.UNISWAP_COMMANDS=r.WETH_PER_CHAIN_ID=r.UNISWAP_EXECUTE_SELECTOR=r.UNISWAP_UNIVERSAL_ROUTER_ADDRESS=void 0,r.UNISWAP_UNIVERSAL_ROUTER_ADDRESS="0x3fc91a3afd70395cd496c647d5a6cc9d4b2b7fad",r.UNISWAP_EXECUTE_SELECTOR="0x3593564c",r.WETH_PER_CHAIN_ID={1:"0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",5:"0xB4FBF271143F4FBf7B91A5ded31805e42b2208d6",11155111:"0xfFf9976782d46CC05630D1f6eBAb18b2324d6B14",42161:"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1",421613:"0xe39Ab88f8A4777030A534146A9Ca3B52bd5D43A3",43114:"0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7",56:"0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c",8453:"0x4200000000000000000000000000000000000006",84531:"0x44D627f900da8AdaC7561bD73aA745F132450798",23888:"0x4300000000000000000000000000000000000004",42220:new Error("Celo isn't supporting wrapping Eth"),44787:new Error("Celo Alfajores isn't supporting wrapping Eth"),10:"0x4200000000000000000000000000000000000006",420:"0x4200000000000000000000000000000000000006",137:"0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270",80001:"0x9c3C9283D3e44854697Cd22D3Faa240Cfb032889"},r.UNISWAP_COMMANDS={"0x08":"V2_SWAP_EXACT_IN","0x09":"V2_SWAP_EXACT_OUT","0x00":"V3_SWAP_EXACT_IN","0x01":"V3_SWAP_EXACT_OUT","0x0b":"WRAP_ETH","0x0c":"UNWRAP_ETH","0x0a":"PERMIT2_PERMIT","0x0d":"PERMIT2_TRANSFER_FROM","0x02":"PERMIT2_PERMIT_BATCH","0x03":"PERMIT2_TRANSFER_FROM_BATCH","0x06":"PAY_PORTION","0x04":"SWEEP"},r.SWAP_COMMANDS=["V2_SWAP_EXACT_IN","V2_SWAP_EXACT_OUT","V3_SWAP_EXACT_IN","V3_SWAP_EXACT_OUT"]}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/modules/Uniswap/constants.js"}],[891,{"./constants":890,"@ethersproject/abi":558,buffer:4106},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.UniswapDecoders=void 0;const n=e("@ethersproject/abi"),s=e("./constants"),i=e=>{const[,,,t]=n.defaultAbiCoder.decode(["address","uint256","uint256","address[]","bool"],e);return t.map((e=>e.toLowerCase()))},a=e=>{const[,,,r]=n.defaultAbiCoder.decode(["address","uint256","uint256","bytes","bool"],e),s=t.from(r.slice(2),"hex"),i=[];let a=0;for(;a<s.length;)i.push(`0x${s.subarray(a,a+20).toString("hex").toLowerCase()}`),a+=23;return i},o=(e,t)=>{const r=s.WETH_PER_CHAIN_ID[t];return r instanceof Error?[]:[r.toLowerCase()]},c=()=>[];r.UniswapDecoders={V2_SWAP_EXACT_IN:i,V2_SWAP_EXACT_OUT:i,V3_SWAP_EXACT_IN:a,V3_SWAP_EXACT_OUT:a,WRAP_ETH:o,UNWRAP_ETH:o,PERMIT2_PERMIT:c,PERMIT2_TRANSFER_FROM:c,PERMIT2_PERMIT_BATCH:c,PERMIT2_TRANSFER_FROM_BATCH:c,PAY_PORTION:c,SWEEP:e=>{const[t]=n.defaultAbiCoder.decode(["address","address","uint256"],e);return[t.toLowerCase()]}}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/modules/Uniswap/decoders.js"}],[892,{"../../services/ledger/erc20":894,"./constants":890,"./decoders":891,"@ethersproject/abi":558,"@ledgerhq/logs":903,buffer:4106},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function o(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(r,"__esModule",{value:!0}),r.loadInfosForUniswap=r.getCommandsAndTokensFromUniswapCalldata=r.isSupported=void 0;const s=e("@ledgerhq/logs"),i=e("@ethersproject/abi"),a=e("../../services/ledger/erc20"),o=e("./decoders"),c=e("./constants");r.isSupported=(e,t,r,n)=>{const s=e.slice(0,10),i=null==t?void 0:t.toLowerCase();if(s!==c.UNISWAP_EXECUTE_SELECTOR||i!==c.UNISWAP_UNIVERSAL_ROUTER_ADDRESS||!n.length)return!1;let a;for(let e=0;e<n.length;e++){const[t,r]=n[e];if(!t)return!1;if(!c.SWAP_COMMANDS.includes(t))continue;const s=t.slice(0,2);if(a&&(a.asset!==r[0]||a.poolVersion!==s))return!1;a={poolVersion:s,asset:r[r.length-1]}}return!0};r.getCommandsAndTokensFromUniswapCalldata=(e,r)=>{try{const[n,s]=new i.Interface(["function execute(bytes calldata commands, bytes[] calldata inputs, uint256 deadline) external payable"]).decodeFunctionData("execute",e);return t.from(n.slice(2),"hex").reduce(((e,t,n)=>{const i=c.UNISWAP_COMMANDS[`0x${t.toString(16).padStart(2,"0")}`];if(!i)return[...e,[undefined,[]]];const a=o.UniswapDecoders[i];return[...e,[i,a(s[n],r)]]}),[])}catch(e){return(0,s.log)("Uniswap","Error decoding Uniswap calldata",e),[]}};r.loadInfosForUniswap=(e,s,i)=>n(void 0,void 0,void 0,(function*(){const o=e.data.slice(0,10),l=(0,r.getCommandsAndTokensFromUniswapCalldata)(e.data,s);if(!(0,r.isSupported)(o,e.to,s,l))return{};const d=Array.from(new Set(l.flatMap((([,e])=>e)))),u=Promise.all(d.map((e=>n(void 0,void 0,void 0,(function*(){var t;const r=yield(0,a.findERC20SignaturesInfo)(i||{},s);return null===(t=(0,a.byContractAddressAndChainId)(e,s,r))||void 0===t?void 0:t.data}))))),f=yield u.then((e=>e.filter((e=>!!e)))),p="Uniswap",h=t.alloc(1);h.writeUIntBE(7,0,1);const g=t.from(p),m=t.from(c.UNISWAP_UNIVERSAL_ROUTER_ADDRESS.slice(2),"hex"),E=t.from(c.UNISWAP_EXECUTE_SELECTOR.slice(2),"hex"),_=t.from("3044022014391e8f355867a57fe88f6a5a4dbcb8bf8f888a9db3ff3449caf72d120396bd02200c13d9c3f79400fe0aa0434ac54d59b79503c9964a4abc3e8cd22763e0242935","hex");return{pluginData:t.concat([h,g,m,E,_]),tokenDescriptors:f}}))}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/modules/Uniswap/index.js"}],[893,{"./loadConfig":896,"@ledgerhq/logs":903,axios:3937},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function o(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.loadInfosForContractMethod=void 0;const i=s(e("axios")),a=e("./loadConfig"),o=e("@ledgerhq/logs");r.loadInfosForContractMethod=(e,t,r,s)=>n(void 0,void 0,void 0,(function*(){const{pluginBaseURL:r,extraPlugins:n}=(0,a.getLoadConfig)(s);let c={};if(r){const e=`${r}/plugins/ethereum.json`;c=yield i.default.get(`${r}/plugins/ethereum.json`).then((e=>e.data)).catch((t=>((0,o.log)("error","could not fetch from "+e+": "+String(t)),null)))}if(n&&(c=Object.assign(Object.assign({},c),n)),!c)return;const l=t.toLowerCase(),d=e.toLowerCase();if(d in c){const e=c[d];if(l in e)return{payload:e[l].serialized_data,signature:e[l].signature,plugin:e[l].plugin,erc20OfInterest:e[l].erc20OfInterest,abi:e.abi}}}))}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/services/ledger/contracts.js"}],[894,{"./loadConfig":896,"@ledgerhq/cryptoassets-evm-signatures/lib/data/evm/index":876,"@ledgerhq/logs":903,axios:3937,buffer:4106},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function o(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.byContractAddressAndChainId=r.findERC20SignaturesInfo=void 0;const i=s(e("axios")),a=e("@ledgerhq/logs"),o=e("@ledgerhq/cryptoassets-evm-signatures/lib/data/evm/index"),c=e("./loadConfig"),l=e=>{const t=e.toLowerCase();return t.startsWith("0x")?t:"0x"+t};r.findERC20SignaturesInfo=(e,t)=>n(void 0,void 0,void 0,(function*(){const{cryptoassetsBaseURL:r}=(0,c.getLoadConfig)(e);if(!r)return null;const n=`${r}/evm/${t}/erc20-signatures.json`;return yield i.default.get(n).then((({data:e})=>{if(!e||"string"!=typeof e)throw new Error(`ERC20 signatures for chainId ${t} file is malformed ${n}`);return e})).catch((e=>((0,a.log)("error","could not fetch from "+n+": "+String(e)),null)))}));r.byContractAddressAndChainId=(e,t,r)=>{var n,s;if(r)try{return d(r).byContractAndChainId(l(e),t)}catch(r){return null===(n=u(t))||void 0===n?void 0:n.byContractAndChainId(l(e),t)}return null===(s=u(t))||void 0===s?void 0:s.byContractAndChainId(l(e),t)};const d=e=>{const r=t.from(e,"base64"),n={},s=[];let i=0;for(;i<r.length;){const e=r.readUInt32BE(i);i+=4;const t=r.slice(i,i+e);let a=0;const o=t.readUInt8(a);a+=1;const c=t.slice(a,a+o).toString("ascii");a+=o;const d=l(t.slice(a,a+20).toString("hex"));a+=20;const u=t.readUInt32BE(a);a+=4;const f=t.readUInt32BE(a);a+=4;const p={ticker:c,contractAddress:d,decimals:u,chainId:f,signature:t.slice(a),data:t};s.push(p),n[String(f)+":"+d]=p,i+=e}return{list:()=>s,byContractAndChainId:(e,t)=>n[String(t)+":"+e]}},u=(()=>{const e={};return t=>{if(e[t])return e[t];const r=o.signatures[t];if(!r)return null;const n=d(r);return e[t]=n,n}})()}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/services/ledger/erc20.js"}],[895,{"../../modules/Uniswap":892,"../../modules/Uniswap/constants":890,"../../utils":898,"./contracts":893,"./erc20":894,"./nfts":897,"@ethersproject/abi":558,"@ethersproject/transactions":650,"@ledgerhq/domain-service/lib/signers/index":878,"@ledgerhq/logs":903,buffer:4106},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function o(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(r,"__esModule",{value:!0});const s=e("@ethersproject/transactions"),i=e("@ethersproject/abi"),a=e("@ledgerhq/logs"),o=e("@ledgerhq/domain-service/lib/signers/index"),c=e("../../modules/Uniswap/constants"),l=e("./erc20"),d=e("../../modules/Uniswap"),u=e("./contracts"),f=e("./nfts"),p=e("../../utils"),h=(e,t,r,s)=>n(void 0,void 0,void 0,(function*(){const n={nfts:[],erc20Tokens:[]};if(s.nft){const s=yield(0,f.getNFTInfo)(e,t,r);s?((0,a.log)("ethereum","loaded nft info for "+s.contractAddress+" ("+s.collectionName+")"),n.nfts.push(s.data)):(0,a.log)("ethereum","couldn't load nft info for "+e)}if(s.token){const s=yield(0,l.findERC20SignaturesInfo)(r,t),i=(0,l.byContractAddressAndChainId)(e,t,s);i?((0,a.log)("ethereum","loaded erc20token info for "+i.contractAddress+" ("+i.ticker+")"),n.erc20Tokens.push(i.data.toString("hex"))):(0,a.log)("ethereum","couldn't load erc20token info for "+e)}return n}));r.default={resolveTransaction:(e,r,o)=>n(void 0,void 0,void 0,(function*(){var l;const g=t.from(e,"hex"),m=(0,s.parse)(`0x${g.toString("hex")}`),E=(0,p.getChainIdAsUint32)(m.chainId),{domains:_}=o,v=null===(l=m.to)||void 0===l?void 0:l.toLowerCase();if(!v)return{nfts:[],erc20Tokens:[],externalPlugin:[],plugin:[],domains:[]};const y=m.data.length>=10&&m.data.substring(0,10),T=[];if(y){const e={token:o.erc20&&p.tokenSelectors.includes(y),nft:o.nft&&p.nftSelectors.includes(y),externalPlugins:o.externalPlugins,uniswapV3:o.uniswapV3},t=yield((e,t,r,s,o,l)=>n(void 0,void 0,void 0,(function*(){let n={externalPlugin:[],plugin:[],nfts:[],erc20Tokens:[],domains:[]};if(l.nft){const r=yield(0,f.loadNftPlugin)(e,t,s,o);r?n.plugin.push(r):(0,a.log)("ethereum","no NFT plugin payload for selector "+t+" and address "+e)}if(l.externalPlugins&&e!==c.UNISWAP_UNIVERSAL_ROUTER_ADDRESS){const c=yield(0,u.loadInfosForContractMethod)(e,t,s,o);if(c){const{plugin:e,payload:l,signature:d,erc20OfInterest:u,abi:f}=c;if(e&&((0,a.log)("ethereum",`found plugin (${e}) for selector: ${t}`),n.externalPlugin.push({payload:l,signature:d})),u&&u.length&&f){const e=new i.Interface(f).parseTransaction(r).args;for(const t of u){const r=t.split(".").reduce(((e,t)=>"-1"===t&&Array.isArray(e)?e[e.length-1]:e[t]),e),i=yield h(r,s,o,{nft:!1,externalPlugins:!1,token:!0,uniswapV3:!1});n=(0,p.mergeResolutions)([n,i])}}}else(0,a.log)("ethereum","no infos for selector "+t)}if(l.uniswapV3){const{pluginData:e,tokenDescriptors:t}=yield(0,d.loadInfosForUniswap)(r,s);e&&t&&(n.externalPlugin.push({payload:e.toString("hex"),signature:""}),n.erc20Tokens.push(...t.map((e=>e.toString("hex")))))}return n})))(v,y,m,E,r,e);t&&T.push(t);const s=yield h(v,E,r,e);s&&T.push(s)}if(_){const e={domains:_};T.push(e)}return(0,p.mergeResolutions)(T)})),signDomainResolution:o.signDomainResolution,signAddressResolution:o.signAddressResolution}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/services/ledger/index.js"}],[896,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getLoadConfig=void 0;const n={nftExplorerBaseURL:"https://nft.api.live.ledger.com/v1/ethereum",pluginBaseURL:"https://cdn.live.ledger.com",extraPlugins:null,cryptoassetsBaseURL:"https://cdn.live.ledger.com/cryptoassets",calServiceURL:"https://crypto-assets-service.api.ledger.com"};r.getLoadConfig=function(e){return Object.assign(Object.assign({},n),e)}}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/services/ledger/loadConfig.js"}],[897,{"./loadConfig":896,"@ledgerhq/logs":903,axios:3937},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function o(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.loadNftPlugin=r.getNFTInfo=void 0;const i=s(e("axios")),a=e("./loadConfig"),o=e("@ledgerhq/logs");r.getNFTInfo=(e,t,r)=>n(void 0,void 0,void 0,(function*(){var n;const{nftExplorerBaseURL:s}=(0,a.getLoadConfig)(r);if(!s)return;const c=`${s}/${t}/contracts/${e}`,l=yield i.default.get(c).then((e=>e.data)).catch((e=>((0,o.log)("error","could not fetch from "+c+": "+String(e)),null)));if(!l)return;const d=l.payload,u=parseInt(d.slice(4,6),16),f=null===(n=d.substr(6,2*u).match(/.{2}/g))||void 0===n?void 0:n.reduce(((e,t)=>e+String.fromCharCode(parseInt(t,16))),"");return{contractAddress:e,collectionName:f||"",data:d}}));r.loadNftPlugin=(e,t,r,s)=>n(void 0,void 0,void 0,(function*(){const{nftExplorerBaseURL:n}=(0,a.getLoadConfig)(s);if(!n)return;const c=`${n}/${r}/contracts/${e}/plugin-selector/${t}`,l=yield i.default.get(c).then((e=>e.data)).catch((e=>((0,o.log)("error","could not fetch from "+c+": "+String(e)),null)));if(!l)return;return l.payload}))}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/services/ledger/nfts.js"}],[898,{"@ethersproject/rlp":634,"@ledgerhq/evm-tools/lib/selectors/index":884,"bignumber.js":899,buffer:4106},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return s(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.safeChunkTransaction=r.getV=r.getChainIdAsUint32=r.getParity=r.mergeResolutions=r.nftSelectors=r.tokenSelectors=r.intAsHexBytes=r.maybeHexBuffer=r.hexBuffer=r.splitPath=r.padHexString=r.ERC1155_CLEAR_SIGNED_SELECTORS=r.ERC721_CLEAR_SIGNED_SELECTORS=r.ERC20_CLEAR_SIGNED_SELECTORS=void 0;const a=e("bignumber.js"),o=i(e("@ethersproject/rlp")),c=e("@ledgerhq/evm-tools/lib/selectors/index");Object.defineProperty(r,"ERC20_CLEAR_SIGNED_SELECTORS",{enumerable:!0,get:function(){return c.ERC20_CLEAR_SIGNED_SELECTORS}}),Object.defineProperty(r,"ERC721_CLEAR_SIGNED_SELECTORS",{enumerable:!0,get:function(){return c.ERC721_CLEAR_SIGNED_SELECTORS}}),Object.defineProperty(r,"ERC1155_CLEAR_SIGNED_SELECTORS",{enumerable:!0,get:function(){return c.ERC1155_CLEAR_SIGNED_SELECTORS}});function l(e){if(!e)return t.alloc(0);const n=e.startsWith("0x")?e.slice(2):e;return t.from((0,r.padHexString)(n),"hex")}r.padHexString=e=>e.length%2?"0"+e:e,r.splitPath=function(e){const t=[];return e.split("/").forEach((e=>{let r=parseInt(e,10);isNaN(r)||(e.length>1&&"'"===e[e.length-1]&&(r+=2147483648),t.push(r))})),t},r.hexBuffer=l,r.maybeHexBuffer=function(e){return e?l(e):null};r.intAsHexBytes=(e,t)=>e.toString(16).padStart(2*t,"0"),r.tokenSelectors=Object.values(c.ERC20_CLEAR_SIGNED_SELECTORS),r.nftSelectors=[...Object.values(c.ERC721_CLEAR_SIGNED_SELECTORS),...Object.values(c.ERC1155_CLEAR_SIGNED_SELECTORS)];r.mergeResolutions=e=>{const t={nfts:[],erc20Tokens:[],externalPlugin:[],plugin:[],domains:[]};for(const r of e)for(const e in r)t[e].push(...r[e]);return t};r.getParity=(e,t,n)=>{if(n)return e;const s=2*(0,r.getChainIdAsUint32)(t)+35;if(s%256===e)return 0;if((s+1)%256===e)return 1;throw new Error("Invalid v value")};r.getChainIdAsUint32=e=>{const n=t.from((0,r.padHexString)(new a.BigNumber(e).toString(16)),"hex").subarray(0,4);return parseInt(n.toString("hex"),16)};r.getV=(e,t,n)=>{if(t.isZero())return e.toString(16);const s=(0,r.getParity)(e,t,n);return n?(0,r.padHexString)(s.toString(16)):(0,r.padHexString)(t.times(2).plus(35).plus(s).toString(16))};r.safeChunkTransaction=(e,r,n)=>{const s=255,i=t.concat([r,e]);if(i.length<=s)return[i];if(n){const e=Math.ceil(i.length/s);return new Array(e).fill(null).map(((e,t)=>i.subarray(t*s,(t+1)*s)))}const a=o.decode(e).slice(-3),c=l(o.encode(a)).subarray(1);let d=0;const u=i.length%s;if(0===u||u>c.length)d=s;else for(let e=1;e<=s;e++){const t=i.length%(s-e);if(0===t||t>c.length){d=s-e;break}}const f=Math.ceil(i.length/d);return new Array(f).fill(null).map(((e,t)=>i.subarray(t*d,(t+1)*d)))}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth",file:"node_modules/@ledgerhq/hw-app-eth/lib/utils.js"}],[899,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){!function(e){var r,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,s=Math.ceil,i=Math.floor,a="[BigNumber Error] ",o=a+"Number primitive has more than 15 significant digits: ",c=1e14,l=14,d=9007199254740991,u=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],f=1e7,p=1e9;function h(e){var t=0|e;return e>0||e===t?t:t-1}function g(e){for(var t,r,n=1,s=e.length,i=e[0]+"";n<s;){for(t=e[n++]+"",r=l-t.length;r--;t="0"+t);i+=t}for(s=i.length;48===i.charCodeAt(--s););return i.slice(0,s+1||1)}function m(e,t){var r,n,s=e.c,i=t.c,a=e.s,o=t.s,c=e.e,l=t.e;if(!a||!o)return null;if(r=s&&!s[0],n=i&&!i[0],r||n)return r?n?0:-o:a;if(a!=o)return a;if(r=a<0,n=c==l,!s||!i)return n?0:!s^r?1:-1;if(!n)return c>l^r?1:-1;for(o=(c=s.length)<(l=i.length)?c:l,a=0;a<o;a++)if(s[a]!=i[a])return s[a]>i[a]^r?1:-1;return c==l?0:c>l^r?1:-1}function E(e,t,r,n){if(e<t||e>r||e!==i(e))throw Error(a+(n||"Argument")+("number"==typeof e?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function _(e){var t=e.c.length-1;return h(e.e/l)==t&&e.c[t]%2!=0}function v(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function y(e,t,r){var n,s;if(t<0){for(s=r+".";++t;s+=r);e=s+e}else if(++t>(n=e.length)){for(s=r,t-=n;--t;s+=r);e+=s}else t<n&&(e=e.slice(0,t)+"."+e.slice(t));return e}r=function e(t){var r,T,A,I,b,P,S,C,M,w,N=K.prototype={constructor:K,toString:null,valueOf:null},O=new K(1),R=20,k=4,L=-7,x=21,D=-1e7,U=1e7,B=!1,F=1,j=0,G={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},V="0123456789abcdefghijklmnopqrstuvwxyz",H=!0;function K(e,t){var r,s,a,c,u,f,p,h,g=this;if(!(g instanceof K))return new K(e,t);if(null==t){if(e&&!0===e._isBigNumber)return g.s=e.s,void(!e.c||e.e>U?g.c=g.e=null:e.e<D?g.c=[g.e=0]:(g.e=e.e,g.c=e.c.slice()));if((f="number"==typeof e)&&0*e==0){if(g.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,u=e;u>=10;u/=10,c++);return void(c>U?g.c=g.e=null:(g.e=c,g.c=[e]))}h=String(e)}else{if(!n.test(h=String(e)))return A(g,h,f);g.s=45==h.charCodeAt(0)?(h=h.slice(1),-1):1}(c=h.indexOf("."))>-1&&(h=h.replace(".","")),(u=h.search(/e/i))>0?(c<0&&(c=u),c+=+h.slice(u+1),h=h.substring(0,u)):c<0&&(c=h.length)}else{if(E(t,2,V.length,"Base"),10==t&&H)return W(g=new K(e),R+g.e+1,k);if(h=String(e),f="number"==typeof e){if(0*e!=0)return A(g,h,f,t);if(g.s=1/e<0?(h=h.slice(1),-1):1,K.DEBUG&&h.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else g.s=45===h.charCodeAt(0)?(h=h.slice(1),-1):1;for(r=V.slice(0,t),c=u=0,p=h.length;u<p;u++)if(r.indexOf(s=h.charAt(u))<0){if("."==s){if(u>c){c=p;continue}}else if(!a&&(h==h.toUpperCase()&&(h=h.toLowerCase())||h==h.toLowerCase()&&(h=h.toUpperCase()))){a=!0,u=-1,c=0;continue}return A(g,String(e),f,t)}f=!1,(c=(h=T(h,t,10,g.s)).indexOf("."))>-1?h=h.replace(".",""):c=h.length}for(u=0;48===h.charCodeAt(u);u++);for(p=h.length;48===h.charCodeAt(--p););if(h=h.slice(u,++p)){if(p-=u,f&&K.DEBUG&&p>15&&(e>d||e!==i(e)))throw Error(o+g.s*e);if((c=c-u-1)>U)g.c=g.e=null;else if(c<D)g.c=[g.e=0];else{if(g.e=c,g.c=[],u=(c+1)%l,c<0&&(u+=l),u<p){for(u&&g.c.push(+h.slice(0,u)),p-=l;u<p;)g.c.push(+h.slice(u,u+=l));u=l-(h=h.slice(u)).length}else u-=p;for(;u--;h+="0");g.c.push(+h)}}else g.c=[g.e=0]}function q(e,t,r,n){var s,i,a,o,c;if(null==r?r=k:E(r,0,8),!e.c)return e.toString();if(s=e.c[0],a=e.e,null==t)c=g(e.c),c=1==n||2==n&&(a<=L||a>=x)?v(c,a):y(c,a,"0");else if(i=(e=W(new K(e),t,r)).e,o=(c=g(e.c)).length,1==n||2==n&&(t<=i||i<=L)){for(;o<t;c+="0",o++);c=v(c,i)}else if(t-=a,c=y(c,i,"0"),i+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=i-o)>0)for(i+1==o&&(c+=".");t--;c+="0");return e.s<0&&s?"-"+c:c}function Y(e,t){for(var r,n,s=1,i=new K(e[0]);s<e.length;s++)(!(n=new K(e[s])).s||(r=m(i,n))===t||0===r&&i.s===t)&&(i=n);return i}function $(e,t,r){for(var n=1,s=t.length;!t[--s];t.pop());for(s=t[0];s>=10;s/=10,n++);return(r=n+r*l-1)>U?e.c=e.e=null:r<D?e.c=[e.e=0]:(e.e=r,e.c=t),e}function W(e,t,r,n){var a,o,d,f,p,h,g,m=e.c,E=u;if(m){e:{for(a=1,f=m[0];f>=10;f/=10,a++);if((o=t-a)<0)o+=l,d=t,p=m[h=0],g=i(p/E[a-d-1]%10);else if((h=s((o+1)/l))>=m.length){if(!n)break e;for(;m.length<=h;m.push(0));p=g=0,a=1,d=(o%=l)-l+1}else{for(p=f=m[h],a=1;f>=10;f/=10,a++);g=(d=(o%=l)-l+a)<0?0:i(p/E[a-d-1]%10)}if(n=n||t<0||null!=m[h+1]||(d<0?p:p%E[a-d-1]),n=r<4?(g||n)&&(0==r||r==(e.s<0?3:2)):g>5||5==g&&(4==r||n||6==r&&(o>0?d>0?p/E[a-d]:0:m[h-1])%10&1||r==(e.s<0?8:7)),t<1||!m[0])return m.length=0,n?(t-=e.e+1,m[0]=E[(l-t%l)%l],e.e=-t||0):m[0]=e.e=0,e;if(0==o?(m.length=h,f=1,h--):(m.length=h+1,f=E[l-o],m[h]=d>0?i(p/E[a-d]%E[d])*f:0),n)for(;;){if(0==h){for(o=1,d=m[0];d>=10;d/=10,o++);for(d=m[0]+=f,f=1;d>=10;d/=10,f++);o!=f&&(e.e++,m[0]==c&&(m[0]=1));break}if(m[h]+=f,m[h]!=c)break;m[h--]=0,f=1}for(o=m.length;0===m[--o];m.pop());}e.e>U?e.c=e.e=null:e.e<D&&(e.c=[e.e=0])}return e}function X(e){var t,r=e.e;return null===r?e.toString():(t=g(e.c),t=r<=L||r>=x?v(t,r):y(t,r,"0"),e.s<0?"-"+t:t)}return K.clone=e,K.ROUND_UP=0,K.ROUND_DOWN=1,K.ROUND_CEIL=2,K.ROUND_FLOOR=3,K.ROUND_HALF_UP=4,K.ROUND_HALF_DOWN=5,K.ROUND_HALF_EVEN=6,K.ROUND_HALF_CEIL=7,K.ROUND_HALF_FLOOR=8,K.EUCLID=9,K.config=K.set=function(e){var t,r;if(null!=e){if("object"!=typeof e)throw Error(a+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(E(r=e[t],0,p,t),R=r),e.hasOwnProperty(t="ROUNDING_MODE")&&(E(r=e[t],0,8,t),k=r),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((r=e[t])&&r.pop?(E(r[0],-p,0,t),E(r[1],0,p,t),L=r[0],x=r[1]):(E(r,-p,p,t),L=-(x=r<0?-r:r))),e.hasOwnProperty(t="RANGE"))if((r=e[t])&&r.pop)E(r[0],-p,-1,t),E(r[1],1,p,t),D=r[0],U=r[1];else{if(E(r,-p,p,t),!r)throw Error(a+t+" cannot be zero: "+r);D=-(U=r<0?-r:r)}if(e.hasOwnProperty(t="CRYPTO")){if((r=e[t])!==!!r)throw Error(a+t+" not true or false: "+r);if(r){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw B=!r,Error(a+"crypto unavailable");B=r}else B=r}if(e.hasOwnProperty(t="MODULO_MODE")&&(E(r=e[t],0,9,t),F=r),e.hasOwnProperty(t="POW_PRECISION")&&(E(r=e[t],0,p,t),j=r),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(r=e[t]))throw Error(a+t+" not an object: "+r);G=r}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(r=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(r))throw Error(a+t+" invalid: "+r);H="0123456789"==r.slice(0,10),V=r}}return{DECIMAL_PLACES:R,ROUNDING_MODE:k,EXPONENTIAL_AT:[L,x],RANGE:[D,U],CRYPTO:B,MODULO_MODE:F,POW_PRECISION:j,FORMAT:G,ALPHABET:V}},K.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!K.DEBUG)return!0;var t,r,n=e.c,s=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(n)){if((1===o||-1===o)&&s>=-p&&s<=p&&s===i(s)){if(0===n[0]){if(0===s&&1===n.length)return!0;break e}if((t=(s+1)%l)<1&&(t+=l),String(n[0]).length==t){for(t=0;t<n.length;t++)if((r=n[t])<0||r>=c||r!==i(r))break e;if(0!==r)return!0}}}else if(null===n&&null===s&&(null===o||1===o||-1===o))return!0;throw Error(a+"Invalid BigNumber: "+e)},K.maximum=K.max=function(){return Y(arguments,-1)},K.minimum=K.min=function(){return Y(arguments,1)},K.random=(I=9007199254740992,b=Math.random()*I&2097151?function(){return i(Math.random()*I)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,r,n,o,c,d=0,f=[],h=new K(O);if(null==e?e=R:E(e,0,p),o=s(e/l),B)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));d<o;)(c=131072*t[d]+(t[d+1]>>>11))>=9e15?(r=crypto.getRandomValues(new Uint32Array(2)),t[d]=r[0],t[d+1]=r[1]):(f.push(c%1e14),d+=2);d=o/2}else{if(!crypto.randomBytes)throw B=!1,Error(a+"crypto unavailable");for(t=crypto.randomBytes(o*=7);d<o;)(c=281474976710656*(31&t[d])+1099511627776*t[d+1]+4294967296*t[d+2]+16777216*t[d+3]+(t[d+4]<<16)+(t[d+5]<<8)+t[d+6])>=9e15?crypto.randomBytes(7).copy(t,d):(f.push(c%1e14),d+=7);d=o/7}if(!B)for(;d<o;)(c=b())<9e15&&(f[d++]=c%1e14);for(o=f[--d],e%=l,o&&e&&(c=u[l-e],f[d]=i(o/c)*c);0===f[d];f.pop(),d--);if(d<0)f=[n=0];else{for(n=-1;0===f[0];f.splice(0,1),n-=l);for(d=1,c=f[0];c>=10;c/=10,d++);d<l&&(n-=l-d)}return h.e=n,h.c=f,h}),K.sum=function(){for(var e=1,t=arguments,r=new K(t[0]);e<t.length;)r=r.plus(t[e++]);return r},T=function(){var e="0123456789";function t(e,t,r,n){for(var s,i,a=[0],o=0,c=e.length;o<c;){for(i=a.length;i--;a[i]*=t);for(a[0]+=n.indexOf(e.charAt(o++)),s=0;s<a.length;s++)a[s]>r-1&&(null==a[s+1]&&(a[s+1]=0),a[s+1]+=a[s]/r|0,a[s]%=r)}return a.reverse()}return function(n,s,i,a,o){var c,l,d,u,f,p,h,m,E=n.indexOf("."),_=R,v=k;for(E>=0&&(u=j,j=0,n=n.replace(".",""),p=(m=new K(s)).pow(n.length-E),j=u,m.c=t(y(g(p.c),p.e,"0"),10,i,e),m.e=m.c.length),d=u=(h=t(n,s,i,o?(c=V,e):(c=e,V))).length;0==h[--u];h.pop());if(!h[0])return c.charAt(0);if(E<0?--d:(p.c=h,p.e=d,p.s=a,h=(p=r(p,m,_,v,i)).c,f=p.r,d=p.e),E=h[l=d+_+1],u=i/2,f=f||l<0||null!=h[l+1],f=v<4?(null!=E||f)&&(0==v||v==(p.s<0?3:2)):E>u||E==u&&(4==v||f||6==v&&1&h[l-1]||v==(p.s<0?8:7)),l<1||!h[0])n=f?y(c.charAt(1),-_,c.charAt(0)):c.charAt(0);else{if(h.length=l,f)for(--i;++h[--l]>i;)h[l]=0,l||(++d,h=[1].concat(h));for(u=h.length;!h[--u];);for(E=0,n="";E<=u;n+=c.charAt(h[E++]));n=y(n,d,c.charAt(0))}return n}}(),r=function(){function e(e,t,r){var n,s,i,a,o=0,c=e.length,l=t%f,d=t/f|0;for(e=e.slice();c--;)o=((s=l*(i=e[c]%f)+(n=d*i+(a=e[c]/f|0)*l)%f*f+o)/r|0)+(n/f|0)+d*a,e[c]=s%r;return o&&(e=[o].concat(e)),e}function t(e,t,r,n){var s,i;if(r!=n)i=r>n?1:-1;else for(s=i=0;s<r;s++)if(e[s]!=t[s]){i=e[s]>t[s]?1:-1;break}return i}function r(e,t,r,n){for(var s=0;r--;)e[r]-=s,s=e[r]<t[r]?1:0,e[r]=s*n+e[r]-t[r];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(n,s,a,o,d){var u,f,p,g,m,E,_,v,y,T,A,I,b,P,S,C,M,w=n.s==s.s?1:-1,N=n.c,O=s.c;if(!(N&&N[0]&&O&&O[0]))return new K(n.s&&s.s&&(N?!O||N[0]!=O[0]:O)?N&&0==N[0]||!O?0*w:w/0:NaN);for(y=(v=new K(w)).c=[],w=a+(f=n.e-s.e)+1,d||(d=c,f=h(n.e/l)-h(s.e/l),w=w/l|0),p=0;O[p]==(N[p]||0);p++);if(O[p]>(N[p]||0)&&f--,w<0)y.push(1),g=!0;else{for(P=N.length,C=O.length,p=0,w+=2,(m=i(d/(O[0]+1)))>1&&(O=e(O,m,d),N=e(N,m,d),C=O.length,P=N.length),b=C,A=(T=N.slice(0,C)).length;A<C;T[A++]=0);M=O.slice(),M=[0].concat(M),S=O[0],O[1]>=d/2&&S++;do{if(m=0,(u=t(O,T,C,A))<0){if(I=T[0],C!=A&&(I=I*d+(T[1]||0)),(m=i(I/S))>1)for(m>=d&&(m=d-1),_=(E=e(O,m,d)).length,A=T.length;1==t(E,T,_,A);)m--,r(E,C<_?M:O,_,d),_=E.length,u=1;else 0==m&&(u=m=1),_=(E=O.slice()).length;if(_<A&&(E=[0].concat(E)),r(T,E,A,d),A=T.length,-1==u)for(;t(O,T,C,A)<1;)m++,r(T,C<A?M:O,A,d),A=T.length}else 0===u&&(m++,T=[0]);y[p++]=m,T[0]?T[A++]=N[b]||0:(T=[N[b]],A=1)}while((b++<P||null!=T[0])&&w--);g=null!=T[0],y[0]||y.splice(0,1)}if(d==c){for(p=1,w=y[0];w>=10;w/=10,p++);W(v,a+(v.e=p+f*l-1)+1,o,g)}else v.e=f,v.r=+g;return v}}(),P=/^(-?)0([xbo])(?=\w[\w.]*$)/i,S=/^([^.]+)\.$/,C=/^\.([^.]+)$/,M=/^-?(Infinity|NaN)$/,w=/^\s*\+(?=[\w.])|^\s+|\s+$/g,A=function(e,t,r,n){var s,i=r?t:t.replace(w,"");if(M.test(i))e.s=isNaN(i)?null:i<0?-1:1;else{if(!r&&(i=i.replace(P,(function(e,t,r){return s="x"==(r=r.toLowerCase())?16:"b"==r?2:8,n&&n!=s?e:t})),n&&(s=n,i=i.replace(S,"$1").replace(C,"0.$1")),t!=i))return new K(i,s);if(K.DEBUG)throw Error(a+"Not a"+(n?" base "+n:"")+" number: "+t);e.s=null}e.c=e.e=null},N.absoluteValue=N.abs=function(){var e=new K(this);return e.s<0&&(e.s=1),e},N.comparedTo=function(e,t){return m(this,new K(e,t))},N.decimalPlaces=N.dp=function(e,t){var r,n,s,i=this;if(null!=e)return E(e,0,p),null==t?t=k:E(t,0,8),W(new K(i),e+i.e+1,t);if(!(r=i.c))return null;if(n=((s=r.length-1)-h(this.e/l))*l,s=r[s])for(;s%10==0;s/=10,n--);return n<0&&(n=0),n},N.dividedBy=N.div=function(e,t){return r(this,new K(e,t),R,k)},N.dividedToIntegerBy=N.idiv=function(e,t){return r(this,new K(e,t),0,1)},N.exponentiatedBy=N.pow=function(e,t){var r,n,o,c,d,u,f,p,h=this;if((e=new K(e)).c&&!e.isInteger())throw Error(a+"Exponent not an integer: "+X(e));if(null!=t&&(t=new K(t)),d=e.e>14,!h.c||!h.c[0]||1==h.c[0]&&!h.e&&1==h.c.length||!e.c||!e.c[0])return p=new K(Math.pow(+X(h),d?e.s*(2-_(e)):+X(e))),t?p.mod(t):p;if(u=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new K(NaN);(n=!u&&h.isInteger()&&t.isInteger())&&(h=h.mod(t))}else{if(e.e>9&&(h.e>0||h.e<-1||(0==h.e?h.c[0]>1||d&&h.c[1]>=24e7:h.c[0]<8e13||d&&h.c[0]<=9999975e7)))return c=h.s<0&&_(e)?-0:0,h.e>-1&&(c=1/c),new K(u?1/c:c);j&&(c=s(j/l+2))}for(d?(r=new K(.5),u&&(e.s=1),f=_(e)):f=(o=Math.abs(+X(e)))%2,p=new K(O);;){if(f){if(!(p=p.times(h)).c)break;c?p.c.length>c&&(p.c.length=c):n&&(p=p.mod(t))}if(o){if(0===(o=i(o/2)))break;f=o%2}else if(W(e=e.times(r),e.e+1,1),e.e>14)f=_(e);else{if(0===(o=+X(e)))break;f=o%2}h=h.times(h),c?h.c&&h.c.length>c&&(h.c.length=c):n&&(h=h.mod(t))}return n?p:(u&&(p=O.div(p)),t?p.mod(t):c?W(p,j,k,undefined):p)},N.integerValue=function(e){var t=new K(this);return null==e?e=k:E(e,0,8),W(t,t.e+1,e)},N.isEqualTo=N.eq=function(e,t){return 0===m(this,new K(e,t))},N.isFinite=function(){return!!this.c},N.isGreaterThan=N.gt=function(e,t){return m(this,new K(e,t))>0},N.isGreaterThanOrEqualTo=N.gte=function(e,t){return 1===(t=m(this,new K(e,t)))||0===t},N.isInteger=function(){return!!this.c&&h(this.e/l)>this.c.length-2},N.isLessThan=N.lt=function(e,t){return m(this,new K(e,t))<0},N.isLessThanOrEqualTo=N.lte=function(e,t){return-1===(t=m(this,new K(e,t)))||0===t},N.isNaN=function(){return!this.s},N.isNegative=function(){return this.s<0},N.isPositive=function(){return this.s>0},N.isZero=function(){return!!this.c&&0==this.c[0]},N.minus=function(e,t){var r,n,s,i,a=this,o=a.s;if(t=(e=new K(e,t)).s,!o||!t)return new K(NaN);if(o!=t)return e.s=-t,a.plus(e);var d=a.e/l,u=e.e/l,f=a.c,p=e.c;if(!d||!u){if(!f||!p)return f?(e.s=-t,e):new K(p?a:NaN);if(!f[0]||!p[0])return p[0]?(e.s=-t,e):new K(f[0]?a:3==k?-0:0)}if(d=h(d),u=h(u),f=f.slice(),o=d-u){for((i=o<0)?(o=-o,s=f):(u=d,s=p),s.reverse(),t=o;t--;s.push(0));s.reverse()}else for(n=(i=(o=f.length)<(t=p.length))?o:t,o=t=0;t<n;t++)if(f[t]!=p[t]){i=f[t]<p[t];break}if(i&&(s=f,f=p,p=s,e.s=-e.s),(t=(n=p.length)-(r=f.length))>0)for(;t--;f[r++]=0);for(t=c-1;n>o;){if(f[--n]<p[n]){for(r=n;r&&!f[--r];f[r]=t);--f[r],f[n]+=c}f[n]-=p[n]}for(;0==f[0];f.splice(0,1),--u);return f[0]?$(e,f,u):(e.s=3==k?-1:1,e.c=[e.e=0],e)},N.modulo=N.mod=function(e,t){var n,s,i=this;return e=new K(e,t),!i.c||!e.s||e.c&&!e.c[0]?new K(NaN):!e.c||i.c&&!i.c[0]?new K(i):(9==F?(s=e.s,e.s=1,n=r(i,e,0,3),e.s=s,n.s*=s):n=r(i,e,0,F),(e=i.minus(n.times(e))).c[0]||1!=F||(e.s=i.s),e)},N.multipliedBy=N.times=function(e,t){var r,n,s,i,a,o,d,u,p,g,m,E,_,v,y,T=this,A=T.c,I=(e=new K(e,t)).c;if(!(A&&I&&A[0]&&I[0]))return!T.s||!e.s||A&&!A[0]&&!I||I&&!I[0]&&!A?e.c=e.e=e.s=null:(e.s*=T.s,A&&I?(e.c=[0],e.e=0):e.c=e.e=null),e;for(n=h(T.e/l)+h(e.e/l),e.s*=T.s,(d=A.length)<(g=I.length)&&(_=A,A=I,I=_,s=d,d=g,g=s),s=d+g,_=[];s--;_.push(0));for(v=c,y=f,s=g;--s>=0;){for(r=0,m=I[s]%y,E=I[s]/y|0,i=s+(a=d);i>s;)r=((u=m*(u=A[--a]%y)+(o=E*u+(p=A[a]/y|0)*m)%y*y+_[i]+r)/v|0)+(o/y|0)+E*p,_[i--]=u%v;_[i]=r}return r?++n:_.splice(0,1),$(e,_,n)},N.negated=function(){var e=new K(this);return e.s=-e.s||null,e},N.plus=function(e,t){var r,n=this,s=n.s;if(t=(e=new K(e,t)).s,!s||!t)return new K(NaN);if(s!=t)return e.s=-t,n.minus(e);var i=n.e/l,a=e.e/l,o=n.c,d=e.c;if(!i||!a){if(!o||!d)return new K(s/0);if(!o[0]||!d[0])return d[0]?e:new K(o[0]?n:0*s)}if(i=h(i),a=h(a),o=o.slice(),s=i-a){for(s>0?(a=i,r=d):(s=-s,r=o),r.reverse();s--;r.push(0));r.reverse()}for((s=o.length)-(t=d.length)<0&&(r=d,d=o,o=r,t=s),s=0;t;)s=(o[--t]=o[t]+d[t]+s)/c|0,o[t]=c===o[t]?0:o[t]%c;return s&&(o=[s].concat(o),++a),$(e,o,a)},N.precision=N.sd=function(e,t){var r,n,s,i=this;if(null!=e&&e!==!!e)return E(e,1,p),null==t?t=k:E(t,0,8),W(new K(i),e,t);if(!(r=i.c))return null;if(n=(s=r.length-1)*l+1,s=r[s]){for(;s%10==0;s/=10,n--);for(s=r[0];s>=10;s/=10,n++);}return e&&i.e+1>n&&(n=i.e+1),n},N.shiftedBy=function(e){return E(e,-9007199254740991,d),this.times("1e"+e)},N.squareRoot=N.sqrt=function(){var e,t,n,s,i,a=this,o=a.c,c=a.s,l=a.e,d=R+4,u=new K("0.5");if(1!==c||!o||!o[0])return new K(!c||c<0&&(!o||o[0])?NaN:o?a:1/0);if(0==(c=Math.sqrt(+X(a)))||c==1/0?(((t=g(o)).length+l)%2==0&&(t+="0"),c=Math.sqrt(+t),l=h((l+1)/2)-(l<0||l%2),n=new K(t=c==1/0?"5e"+l:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+l)):n=new K(c+""),n.c[0])for((c=(l=n.e)+d)<3&&(c=0);;)if(i=n,n=u.times(i.plus(r(a,i,d,1))),g(i.c).slice(0,c)===(t=g(n.c)).slice(0,c)){if(n.e<l&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(s||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(W(n,n.e+R+2,1),e=!n.times(n).eq(a));break}if(!s&&(W(i,i.e+R+2,0),i.times(i).eq(a))){n=i;break}d+=4,c+=4,s=1}return W(n,n.e+R+1,k,e)},N.toExponential=function(e,t){return null!=e&&(E(e,0,p),e++),q(this,e,t,1)},N.toFixed=function(e,t){return null!=e&&(E(e,0,p),e=e+this.e+1),q(this,e,t)},N.toFormat=function(e,t,r){var n,s=this;if(null==r)null!=e&&t&&"object"==typeof t?(r=t,t=null):e&&"object"==typeof e?(r=e,e=t=null):r=G;else if("object"!=typeof r)throw Error(a+"Argument not an object: "+r);if(n=s.toFixed(e,t),s.c){var i,o=n.split("."),c=+r.groupSize,l=+r.secondaryGroupSize,d=r.groupSeparator||"",u=o[0],f=o[1],p=s.s<0,h=p?u.slice(1):u,g=h.length;if(l&&(i=c,c=l,l=i,g-=i),c>0&&g>0){for(i=g%c||c,u=h.substr(0,i);i<g;i+=c)u+=d+h.substr(i,c);l>0&&(u+=d+h.slice(i)),p&&(u="-"+u)}n=f?u+(r.decimalSeparator||"")+((l=+r.fractionGroupSize)?f.replace(new RegExp("\\d{"+l+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):f):u}return(r.prefix||"")+n+(r.suffix||"")},N.toFraction=function(e){var t,n,s,i,o,c,d,f,p,h,m,E,_=this,v=_.c;if(null!=e&&(!(d=new K(e)).isInteger()&&(d.c||1!==d.s)||d.lt(O)))throw Error(a+"Argument "+(d.isInteger()?"out of range: ":"not an integer: ")+X(d));if(!v)return new K(_);for(t=new K(O),p=n=new K(O),s=f=new K(O),E=g(v),o=t.e=E.length-_.e-1,t.c[0]=u[(c=o%l)<0?l+c:c],e=!e||d.comparedTo(t)>0?o>0?t:p:d,c=U,U=1/0,d=new K(E),f.c[0]=0;h=r(d,t,0,1),1!=(i=n.plus(h.times(s))).comparedTo(e);)n=s,s=i,p=f.plus(h.times(i=p)),f=i,t=d.minus(h.times(i=t)),d=i;return i=r(e.minus(n),s,0,1),f=f.plus(i.times(p)),n=n.plus(i.times(s)),f.s=p.s=_.s,m=r(p,s,o*=2,k).minus(_).abs().comparedTo(r(f,n,o,k).minus(_).abs())<1?[p,s]:[f,n],U=c,m},N.toNumber=function(){return+X(this)},N.toPrecision=function(e,t){return null!=e&&E(e,1,p),q(this,e,t,2)},N.toString=function(e){var t,r=this,n=r.s,s=r.e;return null===s?n?(t="Infinity",n<0&&(t="-"+t)):t="NaN":(null==e?t=s<=L||s>=x?v(g(r.c),s):y(g(r.c),s,"0"):10===e&&H?t=y(g((r=W(new K(r),R+s+1,k)).c),r.e,"0"):(E(e,2,V.length,"Base"),t=T(y(g(r.c),s,"0"),10,e,n,!0)),n<0&&r.c[0]&&(t="-"+t)),t},N.valueOf=N.toJSON=function(){return X(this)},N._isBigNumber=!0,null!=t&&K.set(t),K}(),r.default=r.BigNumber=r,"function"==typeof define&&define.amd?define((function(){return r})):void 0!==t&&t.exports?t.exports=r:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=r)}(this)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth>bignumber.js",file:"node_modules/@ledgerhq/hw-app-eth/node_modules/bignumber.js/bignumber.js"}],[9,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.PHISHING_WARNING_PAGE=r.PHISHING_STREAM=r.PHISHING_SAFELIST=r.METAMASK_INPAGE=r.METAMASK_EIP_1193_PROVIDER=r.METAMASK_COOKIE_HANDLER=r.METAMASK_CAIP_MULTICHAIN_PROVIDER=r.LEGACY_PUBLIC_CONFIG=r.LEGACY_PROVIDER=r.LEGACY_INPAGE=r.LEGACY_CONTENT_SCRIPT=r.CONTENT_SCRIPT=void 0;r.CONTENT_SCRIPT="metamask-contentscript",r.METAMASK_INPAGE="metamask-inpage",r.PHISHING_WARNING_PAGE="metamask-phishing-warning-page",r.METAMASK_COOKIE_HANDLER="metamask-cookie-handler",r.METAMASK_EIP_1193_PROVIDER="metamask-provider",r.METAMASK_CAIP_MULTICHAIN_PROVIDER="metamask-multichain-provider",r.PHISHING_SAFELIST="metamask-phishing-safelist",r.PHISHING_STREAM="phishing",r.LEGACY_CONTENT_SCRIPT="contentscript",r.LEGACY_INPAGE="inpage",r.LEGACY_PROVIDER="provider",r.LEGACY_PUBLIC_CONFIG="publicConfig"}}},{package:"$root$",file:"app/scripts/constants/stream.ts"}],[90,{"../../../../shared/lib/accounts/institutional-wallet-snap":5835,"@metamask/base-controller":1476,"@metamask/controller-utils":1559,"@metamask/snaps-utils":2853,"@metamask/transaction-controller":2925},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.InstitutionalSnapController=void 0;var n=e("@metamask/transaction-controller"),s=e("@metamask/snaps-utils"),i=e("@metamask/base-controller"),a=e("@metamask/controller-utils");function o(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function c(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}const l=e("../../../../shared/lib/accounts/institutional-wallet-snap").INSTITUTIONAL_WALLET_SNAP_ID,d="InstitutionalSnapController",u={};var f=new WeakSet;class p extends i.BaseController{constructor({messenger:e}){super({messenger:e,name:d,state:{},metadata:u}),o(this,f),c(f,this,h).call(this)}async deferPublicationHook(e){if(await c(f,this,_).call(this,e)){const t=await c(f,this,m).call(this,e);return await c(f,this,E).call(this,e.id,t),!1}return!0}async beforeCheckPendingTransactionHook(e){return!await c(f,this,_).call(this,e)}}function h(){this.messagingSystem.registerActionHandler(`${d}:publishHook`,this.deferPublicationHook.bind(this)),this.messagingSystem.registerActionHandler(`${d}:beforeCheckPendingTransactionHook`,this.beforeCheckPendingTransactionHook.bind(this))}async function g(e){return await this.messagingSystem.call("SnapController:handleRequest",e)}async function m(e){const t={from:e.txParams.from,to:e.txParams.to,value:e.txParams.value,data:e.txParams.data,chainId:e.chainId},r={snapId:l,origin:a.ORIGIN_METAMASK,handler:s.HandlerType.OnRpcRequest,request:{method:"transactions.getMutableTransactionParameters",params:t}},i=await c(f,this,g).call(this,r);return{hash:i.transaction.transactionHash,nonce:i.transaction.nonce,gasLimit:i.transaction.gasLimit,maxFeePerGas:i.transaction.maxFeePerGas,maxPriorityFeePerGas:i.transaction.maxPriorityFeePerGas,type:i.transaction.type,status:n.TransactionStatus.submitted}}async function E(e,{status:t,hash:r,nonce:n,gasLimit:s,maxFeePerGas:i,maxPriorityFeePerGas:a,type:o}){return await this.messagingSystem.call("TransactionController:updateCustodialTransaction",{transactionId:e,status:t,hash:r,nonce:n,gasLimit:s,maxFeePerGas:i,maxPriorityFeePerGas:a,type:o})}async function _(e){var t;const r=await this.messagingSystem.call("AccountsController:getAccountByAddress",e.txParams.from);return null==r||null===(t=r.options.custodian)||void 0===t?void 0:t.deferPublication}r.InstitutionalSnapController=p}}},{package:"$root$",file:"app/scripts/controllers/institutional-snap/InstitutionalSnapController.ts"}],[900,{"@ledgerhq/errors":881,"@ledgerhq/logs":903,buffer:4106,events:4454},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function o(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.getAltStatusMessage=r.StatusCodes=r.TransportStatusError=r.TransportError=void 0;const i=s(e("events")),a=e("@ledgerhq/errors");Object.defineProperty(r,"TransportError",{enumerable:!0,get:function(){return a.TransportError}}),Object.defineProperty(r,"StatusCodes",{enumerable:!0,get:function(){return a.StatusCodes}}),Object.defineProperty(r,"getAltStatusMessage",{enumerable:!0,get:function(){return a.getAltStatusMessage}}),Object.defineProperty(r,"TransportStatusError",{enumerable:!0,get:function(){return a.TransportStatusError}});const o=e("@ledgerhq/logs");class c{constructor({context:e,logType:r}={}){this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new i.default,this.send=(e,r,s,i,...o)=>n(this,[e,r,s,i,...o],void 0,(function*(e,r,n,s,i=t.alloc(0),o=[a.StatusCodes.OK],{abortTimeoutMs:c}={}){const l=this.tracer.withUpdatedContext({function:"send"});if(i.length>=256)throw l.trace("data.length exceeded 256 bytes limit",{dataLength:i.length}),new a.TransportError("data.length exceed 256 bytes limit. Got: "+i.length,"DataLengthTooBig");l.trace("Starting an exchange",{abortTimeoutMs:c});const d=yield this.exchange(t.concat([t.from([e,r,n,s]),t.from([i.length]),i]),{abortTimeoutMs:c});l.trace("Received response from exchange");const u=d.readUInt16BE(d.length-2);if(!o.some((e=>e===u)))throw new a.TransportStatusError(u);return d})),this._appAPIlock=null,this.tracer=new o.LocalTracer(null!=r?r:"transport",e)}exchange(e,{abortTimeoutMs:t}={}){throw new Error("exchange not implemented")}exchangeBulk(e,t){let r=!1;return(()=>n(this,void 0,void 0,(function*(){if(!r)for(const n of e){const e=yield this.exchange(n);if(r)return;const s=e.readUInt16BE(e.length-2);if(s!==a.StatusCodes.OK)throw new a.TransportStatusError(s);t.next(e)}})))().then((()=>!r&&t.complete()),(e=>!r&&t.error(e))),{unsubscribe:()=>{r=!0}}}setScrambleKey(e){}close(){return Promise.resolve()}on(e,t){this._events.on(e,t)}off(e,t){this._events.removeListener(e,t)}emit(e,...t){this._events.emit(e,...t)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(e){this.exchangeTimeout=e}setExchangeUnresponsiveTimeout(e){this.unresponsiveTimeout=e}static create(e=3e3,t){return new Promise(((r,n)=>{let s=!1;const i=this.listen({next:t=>{s=!0,i&&i.unsubscribe(),o&&clearTimeout(o),this.open(t.descriptor,e).then(r,n)},error:e=>{o&&clearTimeout(o),n(e)},complete:()=>{o&&clearTimeout(o),s||n(new a.TransportError(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),o=t?setTimeout((()=>{i.unsubscribe(),n(new a.TransportError(this.ErrorMessage_ListenTimeout,"ListenTimeout"))}),t):null}))}exchangeAtomicImpl(e){return n(this,void 0,void 0,(function*(){const t=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw t.trace("Atomic exchange is already busy"),new a.TransportRaceCondition("An action was already pending on the Ledger device. Please deny or reconnect.");let r;const n=new Promise((e=>{r=e}));this.exchangeBusyPromise=n;let s=!1;const i=setTimeout((()=>{t.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),s=!0,this.emit("unresponsive")}),this.unresponsiveTimeout);try{const r=yield e();return s&&(t.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),r}finally{t.trace("Finalize, clearing busy guard"),clearTimeout(i),r&&r(),this.exchangeBusyPromise=null}}))}decorateAppAPIMethods(e,t,r){for(const n of t)e[n]=this.decorateAppAPIMethod(n,e[n],e,r)}decorateAppAPIMethod(e,t,r,s){return(...i)=>n(this,void 0,void 0,(function*(){const{_appAPIlock:n}=this;if(n)return Promise.reject(new a.TransportError("Ledger Device is busy (lock "+n+")","TransportLocked"));try{return this._appAPIlock=e,this.setScrambleKey(s),yield t.apply(r,i)}finally{this._appAPIlock=null}}))}setTraceContext(e){this.tracer=this.tracer.withContext(e)}updateTraceContext(e){this.tracer.updateContext(e)}getTraceContext(){return this.tracer.getContext()}}c.ErrorMessage_ListenTimeout="No Ledger device found (timeout)",c.ErrorMessage_NoDeviceFound="No Ledger device found",r.default=c}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth>@ledgerhq/hw-transport",file:"node_modules/@ledgerhq/hw-transport/lib/Transport.js"}],[901,{rxjs:5371},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.setEnvUnsafe=r.setEnv=r.changes=r.getEnvDesc=r.isEnvDefault=r.getEnvDefault=r.getEnv=r.getAllEnvs=r.getAllEnvNames=r.getDefinition=void 0;const n=e("rxjs"),s=e=>{if(!Number.isNaN(e))return parseInt(e,10)},i=e=>{if(!Number.isNaN(e))return parseFloat(e)},a=e=>"boolean"==typeof e?e:!("0"===e||"false"===e),o=e=>"string"==typeof e?e:undefined,c=e=>{const t="string"==typeof e?e.split(","):null;if(Array.isArray(t)&&t.length>0)return t},l={ADDRESS_POISONING_FAMILIES:{def:"evm,tron",parser:o,desc:"List of families impacted by the address poisoning attack"},ANALYTICS_CONSOLE:{def:!1,parser:a,desc:"Show tracking overlays on the app UI"},DEBUG_THEME:{def:!1,parser:a,desc:"Show theme debug overlay UI"},API_ICP_ENDPOINT:{def:"https://icp.coin.ledger.com/",parser:o,desc:"Rosetta API for ICP"},API_CASPER_INDEXER_ENDPOINT:{parser:o,def:"https://casper.coin.ledger.com/indexer",desc:"Casper API url indexer"},API_CASPER_NODE_ENDPOINT:{parser:o,def:"https://casper.coin.ledger.com/node/",desc:"Casper API url node"},API_ALGORAND_BLOCKCHAIN_EXPLORER_API_ENDPOINT:{def:"https://algorand.coin.ledger.com",parser:o,desc:"Node API endpoint for algorand"},API_CELO_INDEXER:{def:"https://celo.coin.ledger.com/indexer/",parser:o,desc:"Explorer API for celo"},API_CELO_NODE:{def:"https://celo.coin.ledger.com/archive/",parser:o,desc:"Node endpoint for celo"},COSMOS_GAS_AMPLIFIER:{def:1.3,parser:s,desc:"Cosmos gas estimate multiplier"},API_FILECOIN_ENDPOINT:{parser:o,def:"https://filecoin.coin.ledger.com",desc:"Filecoin API url"},API_STACKS_ENDPOINT:{parser:o,def:"https://stacks.coin.ledger.com",desc:"Stacks API url"},API_POLKADOT_INDEXER:{parser:o,def:"https://polkadot.coin.ledger.com",desc:"Explorer API for polkadot"},API_POLKADOT_SIDECAR:{parser:o,def:"https://polkadot-sidecar.coin.ledger.com",desc:"Polkadot Sidecar API url"},API_POLKADOT_SIDECAR_CREDENTIALS:{parser:o,def:"",desc:"Polkadot Sidecar API credentials"},API_POLKADOT_NODE:{parser:o,def:"https://polkadot-fullnodes.api.live.ledger.com",desc:"Polkadot Node"},ELROND_API_ENDPOINT:{parser:o,def:"https://elrond.coin.ledger.com",desc:"Elrond API url"},ELROND_DELEGATION_API_ENDPOINT:{parser:o,def:"https://delegations-elrond.coin.ledger.com",desc:"Elrond DELEGATION API url"},API_STELLAR_HORIZON:{parser:o,def:"https://stellar.coin.ledger.com",desc:"Stellar Horizon API url"},API_STELLAR_HORIZON_FETCH_LIMIT:{parser:s,def:100,desc:"Limit of operation that Horizon will fetch per page"},API_STELLAR_HORIZON_STATIC_FEE:{def:!1,parser:a,desc:"Static fee for Stellar account"},API_TEZOS_BAKER:{parser:o,def:"https://tezos-bakers.api.live.ledger.com",desc:"bakers API for tezos"},API_TEZOS_BLOCKCHAIN_EXPLORER_API_ENDPOINT:{def:"https://xtz-explorer.api.live.ledger.com/explorer",parser:o,desc:"Ledger explorer API for tezos"},API_TEZOS_TZKT_API:{def:"https://xtz-tzkt-explorer.api.live.ledger.com",parser:o,desc:"tzkt.io explorer"},API_TEZOS_NODE:{def:"https://xtz-node.api.live.ledger.com",parser:o,desc:"node API for tezos (for broadcast only)"},API_TRONGRID_PROXY:{parser:o,def:"https://tron.coin.ledger.com",desc:"proxy url for trongrid API"},API_SOLANA_PROXY:{parser:o,def:"https://solana.coin.ledger.com",desc:"proxy url for solana API"},SOLANA_VALIDATORS_APP_BASE_URL:{parser:o,def:"https://earn.api.live.ledger.com/v0/network/solana/validator-details",desc:"base url for validators.app validator list"},SOLANA_TESTNET_VALIDATORS_APP_BASE_URL:{parser:o,def:"https://validators-solana.coin.ledger.com/api/v1/validators",desc:"base url for testnet validators.app validator list"},SOLANA_TX_CONFIRMATION_TIMEOUT:{def:1e5,parser:s,desc:"solana transaction broadcast confirmation timeout"},API_HEDERA_MIRROR:{def:"https://hedera.coin.ledger.com",parser:o,desc:"mirror node API for Hedera"},API_VECHAIN_THOREST:{def:"https://vechain.coin.ledger.com",parser:o,desc:"Thorest API for VeChain"},BASE_SOCKET_URL:{def:"wss://scriptrunner.api.live.ledger.com/update",parser:o,desc:"Ledger script runner API"},BOT_TIMEOUT_SCAN_ACCOUNTS:{def:6e5,parser:s,desc:"bot's default timeout for scanAccounts"},BOT_SPEC_DEFAULT_TIMEOUT:{def:18e5,parser:s,desc:"define the default value of spec.skipMutationsTimeout (if not overriden by spec)"},BUY_API_BASE:{def:"https://buy.api.live.ledger.com/buy/v1",parser:o,desc:"Buy crypto API base url - version 1"},CARDANO_API_ENDPOINT:{def:"https://cardano.coin.ledger.com/api",parser:o,desc:"Cardano API url"},CARDANO_TESTNET_API_ENDPOINT:{def:"https://testnet-ledger.cardanoscan.io/api",parser:o,desc:"Cardano API url"},ICON_NODE_ENDPOINT:{parser:o,def:"https://icon.coin.ledger.com/api/v3",desc:"ICON RPC url"},ICON_DEBUG_ENDPOINT:{parser:o,def:"https://icon.coin.ledger.com/api/v3d",desc:"ICON debug RPC url"},ICON_INDEXER_ENDPOINT:{parser:o,def:"https://icon.coin.ledger.com/api/v1",desc:"ICON API url"},ICON_TESTNET_NODE_ENDPOINT:{parser:o,def:"https://berlin.net.solidwallet.io/api/v3",desc:"ICON Berlin Testnet API url"},ICON_TESTNET_DEBUG_ENDPOINT:{parser:o,def:"https://berlin.net.solidwallet.io/api/v3d",desc:"ICON Berlin Testnet debug"},ICON_TESTNET_INDEXER_ENDPOINT:{parser:o,def:"https://tracker.berlin.icon.community/api/v1",desc:"ICON Berlin Testnet API url"},COINAPPS:{def:"",parser:o,desc:"(dev feature) defines the folder for speculos mode that contains Nano apps binaries (.elf) in a specific structure: <device>/<firmware>/<appName>/app_<appVersion>.elf"},CRYPTO_ORG_INDEXER:{def:"https://cryptoorg-rpc-indexer.coin.ledger.com",parser:o,desc:"location of the Cronos POS Chain (formerly Crypto.org) indexer API"},CRYPTO_ORG_TESTNET_INDEXER:{def:"https://cronos-pos.org/explorer/croeseid4",parser:o,desc:"location of the Cronos POS Chain (formerly Crypto.org) indexer testnet API"},CRYPTO_ORG_RPC_URL:{def:"https://cryptoorg-rpc-node.coin.ledger.com",parser:o,desc:"location of the Cronos POS Chain (formerly Crypto.org) chain node"},CRYPTO_ORG_TESTNET_RPC_URL:{def:"https://rpc-testnet-croeseid-4.crypto.org",parser:o,desc:"location of the Cronos POS Chain (formerly Crypto.org) chain testnet node"},DEBUG_UTXO_DISPLAY:{def:4,parser:s,desc:"define maximum number of utxos to display in CLI"},DEBUG_HTTP_RESPONSE:{def:!1,parser:a,desc:"includes HTTP response body in logs"},DEVICE_CANCEL_APDU_FLUSH_MECHANISM:{def:!0,parser:a,desc:"enable a mechanism that send a 0x00 apdu to force device to awake from its 'Processing' UI state"},DEVICE_PROXY_URL:{def:"",parser:o,desc:"enable a proxy to use instead of a physical device"},DEVICE_PROXY_MODEL:{def:"nanoS",parser:o,desc:"allow to override the default model of a proxied device"},DISABLE_TRANSACTION_BROADCAST:{def:!1,parser:a,desc:"disable broadcast of transactions"},DISABLE_SYNC_TOKEN:{def:!0,parser:a,desc:"disable a problematic mechanism of our API"},DISABLE_FW_UPDATE_VERSION_CHECK:{def:!1,parser:a,desc:"disable the version check for firmware update eligibility"},EIP1559_MINIMUM_FEES_GATE:{def:!0,parser:a,desc:"prevents the user from doing an EIP1559 transaction with fees too low"},EIP1559_PRIORITY_FEE_LOWER_GATE:{def:.85,parser:i,desc:"minimum priority fee percents allowed compared to network conditions allowed when EIP1559_MINIMUM_FEES_GATE is activated"},EIP1559_BASE_FEE_MULTIPLIER:{def:1.27,parser:i,desc:"mutiplier for the base fee that is composing the maxFeePerGas property"},EXPERIMENTAL_BLE:{def:!1,parser:a,desc:"enable experimental support of Bluetooth"},EXPERIMENTAL_CURRENCIES:{def:"",parser:o,desc:"enable experimental support of currencies (comma separated)"},EXPERIMENTAL_EXPLORERS:{def:!1,parser:a,desc:"enable experimental explorer APIs"},EXPERIMENTAL_LANGUAGES:{def:!1,parser:a,desc:"enable experimental languages"},EXPERIMENTAL_MANAGER:{def:!1,parser:a,desc:"enable an experimental version of Manager"},EXPERIMENTAL_ROI_CALCULATION:{def:!1,parser:a,desc:"enable an experimental version of the portfolio percentage calculation"},EXPERIMENTAL_SEND_MAX:{def:!1,parser:a,desc:"force enabling SEND MAX even if not yet stable"},EXPERIMENTAL_USB:{def:!1,parser:a,desc:"enable an experimental implementation of USB support"},EXPERIMENTAL_SWAP:{def:!1,parser:a,desc:"enable an experimental swap interface"},EXPLORER:{def:"https://explorers.api.live.ledger.com",parser:o,desc:"Ledger generic explorer API"},EXPLORER_STAGING:{def:"https://explorers.api-01.live.ledger-stg.com",parser:o,desc:"Ledger staging explorer API"},EXPLORER_BETA:{def:"https://explorers.api.live.ledger.com",parser:o,desc:"Ledger generic explorer beta API"},EXPLORER_SATSTACK:{def:"http://localhost:20000",parser:o,desc:"Ledger satstack Bitcoin explorer API"},EXPORT_EXCLUDED_LOG_TYPES:{def:"ble-frame",parser:o,desc:"comma-separated list of excluded log types for exported logs"},EXPORT_MAX_LOGS:{def:5e3,parser:s,desc:"maximum logs to keep for export"},DISABLE_APP_VERSION_REQUIREMENTS:{def:!1,parser:a,desc:"force an old application version to be accepted regardless of its version"},FORCE_PROVIDER:{def:1,parser:s,desc:"use a different provider for app store (for developers only)"},FILTER_ZERO_AMOUNT_ERC20_EVENTS:{def:!0,parser:a,desc:"Remove filter of address poisoning"},GET_CALLS_RETRY:{def:2,parser:s,desc:"how many times to retry a GET http call"},GET_CALLS_TIMEOUT:{def:6e4,parser:s,desc:"how much time to timeout a GET http call"},HIDE_EMPTY_TOKEN_ACCOUNTS:{def:!1,parser:a,desc:"hide the sub accounts when they are empty"},KEYCHAIN_OBSERVABLE_RANGE:{def:0,parser:s,desc:"overrides the gap limit specified by BIP44 (default to 20)"},LEDGER_CLIENT_VERSION:{def:"",parser:o,desc:"the 'X-Ledger-Client-Version' HTTP header to use for queries to Ledger APIs"},LEDGER_COUNTERVALUES_API:{def:"https://countervalues.live.ledger.com",parser:o,desc:"Ledger countervalues API"},LEDGER_REST_API_BASE:{def:"https://explorers.api.live.ledger.com",parser:o,desc:"DEPRECATED"},LEGACY_KT_SUPPORT_TO_YOUR_OWN_RISK:{def:!1,parser:a,desc:"enable sending to KT accounts. Not tested."},MANAGER_API_BASE:{def:"https://manager.api.live.ledger.com/api",parser:o,desc:"Ledger Manager API"},MANAGER_DEV_MODE:{def:!1,parser:a,desc:"enable visibility of utility apps in Manager"},MANAGER_INSTALL_DELAY:{def:1e3,parser:s,desc:"defines the time to wait before installing apps to prevent known glitch (<=1.5.5) when chaining installs"},MAPPING_SERVICE:{def:"https://mapping-service.api.ledger.com",parser:o,desc:""},MAX_ACCOUNT_NAME_SIZE:{def:50,parser:s,desc:"maximum size of account names"},MOCK:{def:"",parser:o,desc:"switch the app into a MOCK mode for test purpose, the value will be used as a seed for the rng. Avoid falsy values."},MOCK_COUNTERVALUES:{def:"",parser:o,desc:"switch the countervalues resolution into a MOCK mode for test purpose"},MOCK_APP_UPDATE:{def:!1,parser:a,desc:"Always shows app update in the manager"},MOCK_EXCHANGE_TEST_CONFIG:{def:!1,parser:a,desc:"mock the cryptoassets config and test partner (in the context of app-exchange)"},MOCK_REMOTE_LIVE_MANIFEST:{def:"",parser:o,desc:"mock remote live app manifest"},MOCK_OS_VERSION:{def:"",parser:o,desc:"if defined, overrides the os and version. format: os@version. Example: Windows_NT@6.1.7601"},MOCK_NO_BYPASS:{def:!1,parser:a,desc:"if defined, avoids bypass of the currentDevice in the store."},NFT_CURRENCIES:{def:["avalanche_c_chain","bsc","ethereum","polygon"],parser:c,desc:"set the currencies where NFT is active"},NFT_ETH_METADATA_SERVICE:{def:"https://nft.api.live.ledger.com",parser:o,desc:"service uri used to get the metadata of an nft"},OPERATION_ADDRESSES_LIMIT:{def:100,parser:s,desc:"limit the number of addresses in from/to of operations"},OPERATION_OPTIMISTIC_RETENTION:{def:18e5,parser:s,desc:"timeout to keep an optimistic operation that was broadcasted but not yet visible from the coin implementation or the API"},OPERATION_PAGE_SIZE_INITIAL:{def:100,parser:s,desc:"defines the initial default operation length page to use"},POLKADOT_ELECTION_STATUS_THRESHOLD:{def:25,parser:s,desc:"in blocks - number of blocks before Polkadot election effectively opens to consider it as open and disable all staking features"},SATSTACK:{def:!1,parser:a,desc:"Switch to satstack mode"},SCAN_FOR_INVALID_PATHS:{def:!1,parser:a,desc:"enable searching accounts in exotic derivation paths"},SEED:{def:"",parser:o,desc:"(dev feature) seed to be used by speculos (device simulator)"},SHOW_LEGACY_NEW_ACCOUNT:{def:!1,parser:a,desc:"allow the creation of legacy accounts"},SIMPLE_HASH_API_BASE:{def:"https://simplehash.api.live.ledger.com/api/v0",parser:o,desc:"SimpleHash API base url"},SKIP_ONBOARDING:{def:!1,parser:a,desc:"dev flag to skip onboarding flow"},SPECULOS_API_PORT:{def:0,parser:s,desc:"API port for speculos"},SPECULOS_PID_OFFSET:{def:0,parser:s,desc:"offset to be added to the speculos pid and avoid collision with other instances"},SPECULOS_USE_WEBSOCKET:{def:!1,parser:a,desc:"Use speculos websocket interface instead of Rest API"},SWAP_API_BASE:{def:"https://swap.ledger.com/v5",parser:o,desc:"Swap API base"},SWAP_USER_IP:{def:"",parser:o,desc:"Swap IP"},SWAP_DISABLE_APPS_INSTALL:{def:!1,parser:a,desc:"bypass app checks on Nano for speculos swap tests"},SYNC_ALL_INTERVAL:{def:48e4,parser:s,desc:"delay between successive sync"},SYNC_BOOT_DELAY:{def:2e3,parser:s,desc:"delay before the sync starts"},SYNC_PENDING_INTERVAL:{def:1e4,parser:s,desc:"delay between sync when an operation is still pending"},SYNC_OUTDATED_CONSIDERED_DELAY:{def:6e5,parser:s,desc:"delay until Live consider a sync outdated"},SYNC_MAX_CONCURRENT:{def:4,parser:s,desc:"maximum limit to synchronize accounts concurrently to limit overload"},BOT_MAX_CONCURRENT:{def:10,parser:s,desc:"maximum limit to run bot spec in parallel"},USER_ID:{def:"",parser:o,desc:"unique identifier of app instance. used to derivate dissociated ids for difference purposes (e.g. the firmware update incremental deployment)."},WALLETCONNECT:{def:!1,parser:a,desc:"is walletconnect enabled"},CLOUD_SYNC_API_STAGING:{def:"https://cloud-sync-backend.api.aws.stg.ldg-tech.com",parser:o,desc:"wallet sync api staging base url"},CLOUD_SYNC_API_PROD:{def:"https://cloud-sync.api.live.ledger.com",parser:o,desc:"wallet sync api production base url"},WITH_DEVICE_POLLING_DELAY:{def:500,parser:i,desc:"delay when polling device"},ANNOUNCEMENTS_API_URL:{def:"https://cdn.live.ledger.com/announcements",parser:o,desc:"url used to fetch new announcements"},ANNOUNCEMENTS_API_VERSION:{def:1,parser:s,desc:"version used for the announcements api"},STATUS_API_URL:{def:"https://ledger.statuspage.io/api",parser:o,desc:"url used to fetch ledger status"},STATUS_API_VERSION:{def:2,parser:s,desc:"version used for ledger status api"},TEZOS_MAX_TX_QUERIES:{def:100,parser:s,desc:"safe max on maximum number of queries to synchronize a tezos account"},TRUSTCHAIN_API_STAGING:{def:"https://trustchain-backend.api.aws.stg.ldg-tech.com",parser:o,desc:"Trustchain API Staging"},TRUSTCHAIN_API_PROD:{def:"https://trustchain.api.live.ledger.com",parser:o,desc:"Trustchain API Prod"},PLATFORM_DEBUG:{def:!1,parser:a,desc:"enable visibility of debug apps and tools in Platform Catalog"},PLATFORM_EXPERIMENTAL_APPS:{def:!1,parser:a,desc:"enable visibility of experimental apps and tools in Platform Catalog"},PLATFORM_MANIFEST_API_URL:{def:"https://live-app-catalog.ledger.com/api/v1/apps",parser:o,desc:"url used to fetch platform app manifests"},PLATFORM_LOCAL_MANIFEST_JSON:{def:"",parser:o,desc:'json manifest for a local (test) platform app manifests. How to use: PLATFORM_LOCAL_MANIFEST_JSON="$(cat /path/to/file.json)"'},PLATFORM_GLOBAL_CATALOG_API_URL:{def:"https://cdn.live.ledger.com/platform/catalog/v1/data.json",parser:o,desc:"url used to fetch platform app manifests"},PLATFORM_GLOBAL_CATALOG_STAGING_API_URL:{def:"https://cdn.live.ledger-stg.com/platform/catalog/v1/data.json",parser:o,desc:"url used to fetch platform app manifests (staging)"},PLATFORM_RAMP_CATALOG_API_URL:{def:"https://cdn.live.ledger.com/platform/trade/v1/data.json",parser:o,desc:"url used to fetch platform app manifests"},PLATFORM_RAMP_CATALOG_STAGING_API_URL:{def:"https://cdn.live.ledger-stg.com/platform/trade/v1/data.json",parser:o,desc:"url used to fetch platform app manifests (staging)"},PLATFORM_API_URL:{def:"",parser:o,desc:"url used to fetch platform catalog"},PLATFORM_API_VERSION:{def:1,parser:s,desc:"version used for the platform api"},PLAYWRIGHT_RUN:{def:!1,parser:a,desc:"true when launched for E2E testing"},MARKET_API_URL:{def:"https://proxycg.api.live.ledger.com/api/v3",parser:o,desc:"Market data api"},USE_LEARN_STAGING_URL:{def:!1,parser:a,desc:"use the staging URL for the learn page"},DYNAMIC_CAL_BASE_URL:{def:"https://cdn.live.ledger.com/cryptoassets",parser:o,desc:"bucket S3 of the dynamic cryptoassets list"},CAL_SERVICE_URL:{def:"https://crypto-assets-service.api.ledger.com",parser:o,desc:"Cryptoassets list service url"},FEATURE_FLAGS:{def:"{}",parser:e=>{try{if("string"!=typeof e)throw new Error;return JSON.parse(e)}catch(e){return undefined}},desc:"key value map for feature flags: {[key in FeatureId]?: Feature]}"},PERFORMANCE_CONSOLE:{def:!1,parser:a,desc:"Show a performance overlay on the app UI"},ETHEREUM_STUCK_TRANSACTION_TIMEOUT:{def:3e5,parser:s,desc:"Time after which an optimisc operation is considered stuck"},EVM_REPLACE_TX_LEGACY_GASPRICE_FACTOR:{def:1.3,parser:i,desc:"Replace transaction gasprice factor for legacy evm transaction. This value should be 1.1 minimum since this is the minimum increase required by most nodes"},EVM_REPLACE_TX_EIP1559_MAXFEE_FACTOR:{def:1.3,parser:i,desc:"Replace transaction max fee factor for EIP1559 evm transaction. This value should be 1.1 minimum since this is the minimum increase required by most nodes"},EVM_REPLACE_TX_EIP1559_MAXPRIORITYFEE_FACTOR:{def:1.1,parser:i,desc:"Replace transaction max priority fee factor for EIP1559 evm transaction. This value should be 1.1 minimum since this is the minimum increase required by most nodes"},EVM_FORCE_LEGACY_TRANSACTIONS:{def:!1,parser:a,desc:"Force transaction type 0 on EVM networks"},ENABLE_NETWORK_LOGS:{def:!1,parser:a,desc:"Enable network request and responses logs. Errors are always logged"},CRYPTO_ASSET_SEARCH_KEYS:{def:["ticker","name","keywords"],parser:c,desc:"Fuse search attributes to find a currency according to user input"},VERBOSE:{def:[],parser:c,desc:'Sets up debug console printing of logs. `VERBOSE=1` or `VERBOSE=true`: to print all logs | `VERBOSE="apdu,hw,transport,hid-verbose"` : filtering on a list of log `type` separated by a `,`'},DEFAULT_TRANSACTION_POLLING_INTERVAL:{def:3e4,parser:s,desc:"Default interval to poll for transaction confirmation in speedup/cancel evm flow (in ms)"},LOW_BATTERY_PERCENTAGE:{def:20,parser:s,desc:"Configure the low battery percentage threshold"},LOG_DRAWERS:{def:!1,parser:a,desc:"Enable logs for drawers"}};r.getDefinition=e=>e in l?l[e]:undefined;const d=Object.keys(l).reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:l[t].def})),{}),u=Object.assign({},d);r.getAllEnvNames=()=>Object.keys(l);r.getAllEnvs=()=>Object.assign({},u);r.getEnv=e=>u[e];r.getEnvDefault=e=>d[e];r.isEnvDefault=e=>u[e]===d[e];r.getEnvDesc=e=>l[e].desc,r.changes=new n.Subject;r.setEnv=(e,t)=>{const n=u[e];n!==t&&(u[e]=t,r.changes.next({name:e,value:t,oldValue:n}))};r.setEnvUnsafe=(e,t)=>{const n=(0,r.getDefinition)(e);if(!n)return!1;const{parser:s}=n,i=s(t);return i===undefined||null===i?(console.warn(`Invalid ENV value for ${e}`),!1):((0,r.setEnv)(e,i),!0)}}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth>@ledgerhq/evm-tools>@ledgerhq/live-env",file:"node_modules/@ledgerhq/live-env/lib/env.js"}],[902,{"./env":901},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),s(e("./env"),r)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth>@ledgerhq/evm-tools>@ledgerhq/live-env",file:"node_modules/@ledgerhq/live-env/lib/index.js"}],[903,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.listen=r.LocalTracer=r.trace=r.log=void 0;let n=0;const s=[];r.log=(e,t,r)=>{const s={type:e,id:String(++n),date:new Date};t&&(s.message=t),r&&(s.data=r),a(s)};r.trace=({type:e,message:t,data:r,context:s})=>{const i={type:e,id:String(++n),date:new Date};t&&(i.message=t),r&&(i.data=r),s&&(i.context=s),a(i)};class i{constructor(e,t){this.type=e,this.context=t}trace(e,t){(0,r.trace)({type:this.type,message:e,data:t,context:this.context})}getContext(){return this.context}setContext(e){this.context=e}updateContext(e){this.context=Object.assign(Object.assign({},this.context),e)}getType(){return this.type}setType(e){this.type=e}withType(e){return new i(e,this.context)}withContext(e){return new i(this.type,e)}withUpdatedContext(e){return new i(this.type,Object.assign(Object.assign({},this.context),e))}}r.LocalTracer=i;function a(e){for(let t=0;t<s.length;t++)try{s[t](e)}catch(e){console.error(e)}}r.listen=e=>(s.push(e),()=>{const t=s.indexOf(e);-1!==t&&(s[t]=s[s.length-1],s.pop())}),"undefined"!=typeof window&&(window.__ledgerLogsListen=r.listen)}}},{package:"@metamask/eth-ledger-bridge-keyring>@ledgerhq/hw-app-eth>@ledgerhq/logs",file:"node_modules/@ledgerhq/logs/lib/index.js"}],[91,{"../../../development/build/constants":443,"../../../shared/constants/alarms":5795,"../../../shared/constants/app":5798,"../../../shared/constants/keyring":5807,"../../../shared/constants/metametrics":5810,"../../../shared/constants/time":5827,"../../../shared/constants/transaction":5829,"../../../shared/lib/trace":5892,"../../../shared/modules/mv3.utils":5913,"../lib/util":226,"@metamask/base-controller":1476,"@metamask/name-controller":2309,"@metamask/utils":2974,buffer:4106,"ethereumjs-util":4363,lodash:4912,uuid:5741},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.overrideAnonymousEventNames=r.getDefaultMetaMetricsControllerState=r.default=void 0;var n=e("lodash"),s=e("ethereumjs-util"),i=e("uuid"),a=e("@metamask/name-controller"),o=e("@metamask/utils"),c=e("@metamask/base-controller"),l=e("../../../shared/constants/app"),d=e("../../../shared/constants/metametrics"),u=e("../../../shared/constants/time"),f=e("../../../shared/modules/mv3.utils"),p=e("../../../shared/constants/alarms"),h=e("../lib/util"),g=e("../../../shared/constants/transaction"),m=e("../../../shared/lib/trace"),E=e("../../../development/build/constants"),_=e("../../../shared/constants/keyring");function v(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(e,t,r){T(e,t),t.set(e,r)}function T(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function A(e,t){return e.get(b(e,t))}function I(e,t,r){return e.set(b(e,t),r),r}function b(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}const P=r.overrideAnonymousEventNames={[g.TransactionMetaMetricsEvent.added]:g.AnonymousTransactionMetaMetricsEvent.added,[g.TransactionMetaMetricsEvent.approved]:g.AnonymousTransactionMetaMetricsEvent.approved,[g.TransactionMetaMetricsEvent.finalized]:g.AnonymousTransactionMetaMetricsEvent.finalized,[g.TransactionMetaMetricsEvent.rejected]:g.AnonymousTransactionMetaMetricsEvent.rejected,[g.TransactionMetaMetricsEvent.submitted]:g.AnonymousTransactionMetaMetricsEvent.submitted,[d.MetaMetricsEventName.SignatureRequested]:d.MetaMetricsEventName.SignatureRequestedAnon,[d.MetaMetricsEventName.SignatureApproved]:d.MetaMetricsEventName.SignatureApprovedAnon,[d.MetaMetricsEventName.SignatureRejected]:d.MetaMetricsEventName.SignatureRejectedAnon},S=e=>{setTimeout((()=>{throw e}))},C=e=>{const t=[];return e.uniqueIdentifier&&t.push(e.uniqueIdentifier),e.actionId&&t.push(e.actionId),t.length&&e.isDuplicateAnonymizedEvent&&t.push("0x000"),t.length?t.join("-"):(0,h.generateRandomId)()},M={'You must pass either an "anonymousId" or a "userId".':!0},w={metaMetricsId:{persist:!0,anonymous:!0},participateInMetaMetrics:{persist:!0,anonymous:!0},latestNonAnonymousEventTimestamp:{persist:!0,anonymous:!0},fragments:{persist:!0,anonymous:!1},eventsBeforeMetricsOptIn:{persist:!0,anonymous:!1},tracesBeforeMetricsOptIn:{persist:!0,anonymous:!1},traits:{persist:!0,anonymous:!1},dataCollectionForMarketing:{persist:!0,anonymous:!1},marketingCampaignCookieId:{persist:!0,anonymous:!0},segmentApiCalls:{persist:!0,anonymous:!1}},N=()=>({participateInMetaMetrics:null,metaMetricsId:null,dataCollectionForMarketing:null,marketingCampaignCookieId:null,latestNonAnonymousEventTimestamp:0,eventsBeforeMetricsOptIn:[],tracesBeforeMetricsOptIn:[],traits:{},fragments:{},segmentApiCalls:{}});r.getDefaultMetaMetricsControllerState=N;var O=new WeakMap,R=new WeakMap,k=new WeakMap,L=new WeakMap,x=new WeakSet,D=new WeakMap;class U extends c.BaseController{constructor({state:e={},messenger:t,segment:r,version:s,environment:i,extension:a,captureException:c=S}){var l,d;super({name:"MetaMetricsController",metadata:w,state:{participateInMetaMetrics:null,metaMetricsId:null,dataCollectionForMarketing:null,marketingCampaignCookieId:null,latestNonAnonymousEventTimestamp:0,eventsBeforeMetricsOptIn:[],tracesBeforeMetricsOptIn:[],traits:{},fragments:{},segmentApiCalls:{},...e},messenger:t}),T(l=this,d=x),d.add(l),y(this,O,void 0),v(this,"chainId",void 0),v(this,"locale",void 0),v(this,"previousUserTraits",void 0),v(this,"version",void 0),y(this,R,void 0),y(this,k,void 0),y(this,L,void 0),y(this,D,(0,n.memoize)(((e={})=>Object.values(e).reduce(((e,t)=>e.concat(...Object.values(t))),[])))),I(O,this,(e=>{const t=(0,o.getErrorMessage)(e);M[t]||c(e)})),this.chainId=b(x,this,B).call(this);const g=this.messagingSystem.call("PreferencesController:getState");this.locale=g.currentLocale.replace("_","-"),this.version="production"===i?s:`${s}-${i}`,I(R,this,a),I(k,this,i);const m=(0,n.omitBy)(e.fragments,"persist");this.messagingSystem.subscribe("PreferencesController:stateChange",(({currentLocale:e})=>{this.locale=null==e?void 0:e.replace("_","-")})),this.messagingSystem.subscribe("NetworkController:networkDidChange",(({selectedNetworkClientId:e})=>{this.chainId=b(x,this,B).call(this,e)})),I(L,this,r),Object.values(m).forEach((e=>{this.processAbandonedFragment(e)})),f.isManifestV3&&Object.values(e.segmentApiCalls||{}).forEach((({eventType:e,payload:t})=>{try{b(x,this,J).call(this,e,t)}catch(e){A(O,this).call(this,e)}})),f.isManifestV3?(A(R,this).alarms.getAll().then((e=>{(0,h.checkAlarmExists)(e,p.METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM)||A(R,this).alarms.create(p.METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM,{delayInMinutes:1,periodInMinutes:1})})),A(R,this).alarms.onAlarm.addListener((e=>{e.name===p.METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM&&this.finalizeAbandonedFragments()}))):setInterval((()=>{this.finalizeAbandonedFragments()}),30*u.SECOND)}finalizeAbandonedFragments(){Object.values(this.state.fragments).forEach((e=>{e.timeout&&e.lastUpdated&&Date.now()-e.lastUpdated/1e3>e.timeout&&this.processAbandonedFragment(e)}))}generateMetaMetricsId(){return(0,s.bufferToHex)((0,s.keccak)(t.from(String(Date.now())+String(Math.round(Math.random()*Number.MAX_SAFE_INTEGER)))))}createEventFragment(e){if(!e.successEvent)throw new Error(`Must specify success event. Success event was: ${e.event}. Payload keys were: ${Object.keys(e)}. ${"object"==typeof e.properties?`Payload property keys were: ${Object.keys(e.properties)}`:""}`);const{fragments:t}=this.state,r=e.uniqueIdentifier??(0,i.v4)(),s={id:r,...e,lastUpdated:Date.now()},a=e.initialEvent===g.TransactionMetaMetricsEvent.submitted&&t[r]?{...t[r],canDeleteIfAbandoned:!1}:{};return this.update((e=>{e.fragments[r]=(0,n.merge)({},a,s)})),s.initialEvent&&this.trackEvent({event:s.initialEvent,category:s.category,properties:s.properties,sensitiveProperties:s.sensitiveProperties,page:s.page,referrer:s.referrer,revenue:s.revenue,value:s.value,currency:s.currency,environmentType:s.environmentType,actionId:e.actionId,uniqueIdentifier:e.uniqueIdentifier}),s}getEventFragmentById(e){return this.state.fragments[e]}processAbandonedFragment(e){e.canDeleteIfAbandoned?this.deleteEventFragment(e.id):this.finalizeEventFragment(e.id,{abandoned:!0})}updateEventFragment(e,t){const{fragments:r}=this.state,s=r[e];if(!s&&e.includes("transaction-submitted-"))this.update((r=>{r.fragments[e]={canDeleteIfAbandoned:!0,category:d.MetaMetricsEventCategory.Transactions,successEvent:g.TransactionMetaMetricsEvent.finalized,id:e,...t,lastUpdated:Date.now()}}));else{if(!s)throw new Error(`Event fragment with id ${e} does not exist.`);this.update((r=>{r.fragments[e]=(0,n.merge)(r.fragments[e],{...t,lastUpdated:Date.now()})}))}}deleteEventFragment(e){this.state.fragments[e]&&this.update((t=>{delete t.fragments[e]}))}finalizeEventFragment(e,{abandoned:t=!1,page:r,referrer:n}={}){const s=this.state.fragments[e];if(!s)throw new Error(`Funnel with id ${e} does not exist.`);const i=t?s.failureEvent:s.successEvent;this.trackEvent({event:i??"",category:s.category,properties:s.properties,sensitiveProperties:s.sensitiveProperties,page:r??s.page,referrer:s.referrer??n,revenue:s.revenue,value:s.value,currency:s.currency,environmentType:s.environmentType,actionId:s.actionId,uniqueIdentifier:s.uniqueIdentifier?`${s.uniqueIdentifier}-${t?"failure":"success"}`:undefined}),this.update((t=>{delete t.fragments[e]}))}identify(e){const{metaMetricsId:t,participateInMetaMetrics:r}=this.state;if(!r||!t||!e)return;if("object"!=typeof e)return void console.warn("MetaMetricsController#identify: userTraits parameter must be an object. Received type: "+typeof e);const n=b(x,this,H).call(this,e);b(x,this,$).call(this,n)}updateExtensionUninstallUrl(e,r){const n={av:this.version};e&&(n.mmi=t.from(r).toString("base64"),n.env=A(k,this));const s=new URLSearchParams(n);A(R,this)&&A(R,this).runtime&&A(R,this).runtime.setUninstallURL(`https://metamask.io/uninstalled?${s}`)}async setParticipateInMetaMetrics(e){const{metaMetricsId:t}=this.state,r=e&&!t?this.generateMetaMetricsId():t;return this.update((t=>{t.participateInMetaMetrics=e,t.metaMetricsId=r})),e?(this.trackEventsAfterMetricsOptIn(),this.clearEventsAfterMetricsOptIn(),this.trackTracesAfterMetricsOptIn(),this.clearTracesAfterMetricsOptIn()):this.state.marketingCampaignCookieId&&this.setMarketingCampaignCookieId(null),A(k,this)!==E.ENVIRONMENT.DEVELOPMENT&&null!==r&&this.updateExtensionUninstallUrl(e,r),r}setDataCollectionForMarketing(e){const{metaMetricsId:t}=this.state;return this.update((t=>{t.dataCollectionForMarketing=e})),!e&&this.state.marketingCampaignCookieId&&this.setMarketingCampaignCookieId(null),t}setMarketingCampaignCookieId(e){this.update((t=>{t.marketingCampaignCookieId=e}))}trackPage(e,t){try{if(!1===this.state.participateInMetaMetrics)return;if(null===this.state.participateInMetaMetrics&&(null==t||!t.isOptInPath))return;const{name:r,params:n,environmentType:s,page:i,referrer:a,actionId:o}=e,{metaMetricsId:c}=this.state,l=c?"userId":"anonymousId",u=c??d.METAMETRICS_ANONYMOUS_ID;b(x,this,J).call(this,"page",{messageId:C({actionId:o}),[l]:u,name:r,properties:{params:n,locale:this.locale,chain_id:this.chainId,environment_type:s},context:b(x,this,G).call(this,a,i)})}catch(e){A(O,this).call(this,e)}}trackEvent(e,t){b(x,this,j).call(this,e),b(x,this,F).call(this,e,t).catch((e=>{A(O,this).call(this,e)}))}handleMetaMaskStateUpdate(e){const t=this._buildUserTraitsObject(e);t&&this.identify(t)}trackEventsAfterMetricsOptIn(){const{eventsBeforeMetricsOptIn:e}=this.state;e.forEach((e=>{this.trackEvent(e)}))}clearEventsAfterMetricsOptIn(){this.update((e=>{e.eventsBeforeMetricsOptIn=[]}))}addEventBeforeMetricsOptIn(e){this.update((t=>{t.eventsBeforeMetricsOptIn.push(e)}))}trackTracesAfterMetricsOptIn(){const{tracesBeforeMetricsOptIn:e}=this.state;e.forEach((e=>{"start"===e.type?(0,m.trace)(e.request):"end"===e.type&&(0,m.endTrace)(e.request)}))}clearTracesAfterMetricsOptIn(){this.update((e=>{e.tracesBeforeMetricsOptIn=[]}))}addTraceBeforeMetricsOptIn(e){this.update((t=>{t.tracesBeforeMetricsOptIn.push(e)}))}bufferedTrace(e,t){if(this.state.participateInMetaMetrics)return t?(0,m.trace)(e,t):(0,m.trace)(e);let r;if(e.parentContext&&"object"==typeof e.parentContext){const t=e.parentContext;r=null==t?void 0:t._name}return this.addTraceBeforeMetricsOptIn({type:"start",request:{...e,parentContext:undefined,startTime:e.startTime??Date.now()},parentTraceName:r}),undefined}bufferedEndTrace(e){this.state.participateInMetaMetrics?(0,m.endTrace)(e):this.addTraceBeforeMetricsOptIn({type:"end",request:{...e,timestamp:e.timestamp??Date.now()}})}updateTraits(e){this.update((t=>{t.traits={...t.traits,...e}}))}getMetaMetricsId(){let{metaMetricsId:e}=this.state;return e||(e=this.generateMetaMetricsId(),this.update((t=>{t.metaMetricsId=e}))),e}_buildUserTraitsObject(e){var t,r,s;const{traits:i}=this.state,a={[d.MetaMetricsUserTrait.AddressBookEntries]:(0,n.sum)(Object.values(e.addressBook).map(n.size)),[d.MetaMetricsUserTrait.InstallDateExt]:i[d.MetaMetricsUserTrait.InstallDateExt]||"",[d.MetaMetricsUserTrait.LedgerConnectionType]:e.ledgerTransportType,[d.MetaMetricsUserTrait.NetworksAdded]:Object.values(e.networkConfigurationsByChainId).map((e=>e.chainId)),[d.MetaMetricsUserTrait.NetworksWithoutTicker]:Object.values(e.networkConfigurationsByChainId).filter((({nativeCurrency:e})=>!e)).map((({chainId:e})=>e)),[d.MetaMetricsUserTrait.ChainIdList]:[...Object.keys(e.networkConfigurationsByChainId).map((e=>`eip155:${parseInt(e,16)}`)),...Object.keys(e.multichainNetworkConfigurationsByChainId)],[d.MetaMetricsUserTrait.NftAutodetectionEnabled]:e.useNftDetection,[d.MetaMetricsUserTrait.NumberOfAccounts]:Object.values(e.internalAccounts.accounts).length,[d.MetaMetricsUserTrait.NumberOfNftCollections]:b(x,this,K).call(this,e.allNfts),[d.MetaMetricsUserTrait.NumberOfNfts]:A(D,this).call(this,e.allNfts).length,[d.MetaMetricsUserTrait.NumberOfTokens]:b(x,this,q).call(this,e.allTokens),[d.MetaMetricsUserTrait.NumberOfHDEntropies]:b(x,this,Y).call(this,e)??(null===(t=this.previousUserTraits)||void 0===t?void 0:t.number_of_hd_entropies),[d.MetaMetricsUserTrait.OpenSeaApiEnabled]:e.openSeaEnabled,[d.MetaMetricsUserTrait.ThreeBoxEnabled]:!1,[d.MetaMetricsUserTrait.Theme]:e.theme||"default",[d.MetaMetricsUserTrait.TokenDetectionEnabled]:e.useTokenDetection,[d.MetaMetricsUserTrait.ShowNativeTokenAsMainBalance]:e.ShowNativeTokenAsMainBalance,[d.MetaMetricsUserTrait.CurrentCurrency]:e.currentCurrency,[d.MetaMetricsUserTrait.SecurityProviders]:e.securityAlertsEnabled?["blockaid"]:[],[d.MetaMetricsUserTrait.PetnameAddressCount]:b(x,this,Q).call(this,e),[d.MetaMetricsUserTrait.IsMetricsOptedIn]:e.participateInMetaMetrics,[d.MetaMetricsUserTrait.HasMarketingConsent]:e.dataCollectionForMarketing,[d.MetaMetricsUserTrait.TokenSortPreference]:(null===(r=e.tokenSortConfig)||void 0===r?void 0:r.key)||"",[d.MetaMetricsUserTrait.PrivacyModeEnabled]:e.preferences.privacyMode,[d.MetaMetricsUserTrait.NetworkFilterPreference]:Object.keys(e.preferences.tokenNetworkFilter||{}),[d.MetaMetricsUserTrait.ProfileId]:null===(s=Object.entries(e.srpSessionData||{}))||void 0===s||null===(s=s[0])||void 0===s||null===(s=s[1])||void 0===s||null===(s=s.profile)||void 0===s?void 0:s.profileId};if(!this.previousUserTraits&&e.participateInMetaMetrics)return this.previousUserTraits=a,a;if(this.previousUserTraits&&!(0,n.isEqual)(this.previousUserTraits,a)){const t=(0,n.pickBy)(a,((e,t)=>{const r=this.previousUserTraits[t];return!(0,n.isEqual)(r,e)}));return e.participateInMetaMetrics&&(this.previousUserTraits=a),t}return null}}function B(e){const t=e||this.messagingSystem.call("NetworkController:getState").selectedNetworkClientId,{configuration:{chainId:r}}=this.messagingSystem.call("NetworkController:getNetworkClientById",t);return r}async function F(e,t){if(!(this.state.participateInMetaMetrics||null!=t&&t.isOptIn))return;const r=[];if(e.sensitiveProperties){if(!0===(null==t?void 0:t.excludeMetaMetricsId))throw new Error("sensitiveProperties was specified in an event payload that also set the excludeMetaMetricsId flag");const s=P[`${e.event}`],i={...e,event:s??e.event},a=(0,n.merge)({...i.sensitiveProperties},{...i.properties});r.push(b(x,this,Z).call(this,b(x,this,V).call(this,{...i,properties:a,isDuplicateAnonymizedEvent:!0}),{...t,excludeMetaMetricsId:!0}))}r.push(b(x,this,Z).call(this,b(x,this,V).call(this,e),t)),await Promise.all(r)}function j(e){if(!e.event)throw new Error(`Must specify event. Event was: ${e.event}. Payload keys were: ${Object.keys(e)}. ${"object"==typeof e.properties?`Payload property keys were: ${Object.keys(e.properties)}`:""}`)}function G(e,t=d.METAMETRICS_BACKGROUND_PAGE_OBJECT){return{app:{name:"MetaMask Extension",version:this.version},userAgent:window.navigator.userAgent,page:t,referrer:e,marketingCampaignCookieId:this.state.marketingCampaignCookieId}}function V(e){const{event:t,properties:r,revenue:s,value:i,currency:a,category:o,page:c,referrer:d,environmentType:u=l.ENVIRONMENT_TYPE_BACKGROUND}=e;let f;return f=r&&"chain_id_caip"in r&&"string"==typeof r.chain_id_caip?null:r&&"chain_id"in r&&"string"==typeof r.chain_id?r.chain_id:this.chainId,{event:t,messageId:C(e),properties:{...(0,n.omit)(r,["revenue","locale","currency","value"]),revenue:s,value:i,currency:a,category:o,locale:this.locale,chain_id:f,environment_type:u},context:b(x,this,G).call(this,d,c)}}function H(e){return Object.entries(e).reduce(((e,[t,r])=>b(x,this,z).call(this,r)?{...e,[t]:r.toISOString()}:b(x,this,W).call(this,r)?{...e,[t]:r}:(console.warn(`MetaMetricsController: "${t}" value is not a valid trait type`),e)),{})}function K(e={}){const t=A(D,this).call(this,e).map((e=>e.address));return new Set(t).size}function q(e){return Object.values(e).reduce(((e,t)=>e+(0,n.sum)(Object.values(t).map(n.size))),0)}function Y(e){var t;return(null===(t=e.keyrings)||void 0===t?void 0:t.filter((e=>e.type===_.KeyringType.hdKeyTree)).length)??0}function $(e){const{metaMetricsId:t}=this.state;if(e&&0!==Object.keys(e).length)try{b(x,this,J).call(this,"identify",{userId:t??undefined,traits:e})}catch(e){A(O,this).call(this,e)}else console.warn("MetaMetricsController#_identify: No userTraits found")}function W(e){const t=typeof e;return"string"===t||"boolean"===t||"number"===t||b(x,this,X).call(this,e)||b(x,this,z).call(this,e)}function X(e){return Array.isArray(e)&&(e.every((e=>"string"==typeof e))||e.every((e=>"boolean"==typeof e))||e.every((e=>"number"==typeof e)))}function z(e){return"[object Date]"===Object.prototype.toString.call(e)}function Z(e,t){const{isOptIn:r,metaMetricsId:n,matomoEvent:s,flushImmediately:i}=t||{};let a="userId",c=this.state.metaMetricsId,l=(null==t?void 0:t.excludeMetaMetricsId)??!1;const u=Boolean(e.event.match(/^send|^confirm/iu));return!1!==(null==t?void 0:t.excludeMetaMetricsId)&&u&&(l=!0),l||r&&!n?(a="anonymousId",c=d.METAMETRICS_ANONYMOUS_ID):r&&n&&(c=n),e[a]=c??undefined,!0===s&&(e.properties.legacy_event=!0),new Promise(((t,r)=>{b(x,this,J).call(this,"track",e,(e=>{if(e){const t=(0,o.isErrorWithMessage)(e)?e.message:"",n=(0,o.isErrorWithStack)(e)?e.stack:undefined,s=new Error(t);return n&&(s.stack=n),r(s)}return t()})),i&&A(L,this).flush()}))}function J(e,t,r){const{metaMetricsId:n,participateInMetaMetrics:s,latestNonAnonymousEventTimestamp:i}=this.state;if(!s||!n)return;const a=t.messageId||(0,h.generateRandomId)();let o=new Date;if(t.timestamp){const e=new Date(t.timestamp);(0,h.isValidDate)(e)&&(o=e)}const c={...t,messageId:a,timestamp:o};this.update((t=>{t.latestNonAnonymousEventTimestamp=c.anonymousId===d.METAMETRICS_ANONYMOUS_ID?i:o.valueOf(),t.segmentApiCalls[a]={eventType:e,payload:{...c,timestamp:c.timestamp.toString()}}}));A(L,this)[e](c,(e=>(this.update((e=>{delete e.segmentApiCalls[a]})),null==r?void 0:r(e))))}function Q(e){var t;const r=(null===(t=e.names)||void 0===t?void 0:t[a.NameType.ETHEREUM_ADDRESS])??{};return Object.keys(r).reduce(((e,t)=>{const n=r[t];return e+Object.keys(n).reduce(((e,t)=>{var r;return e+(Boolean(null===(r=n[t].name)||void 0===r?void 0:r.length)?1:0)}),0)}),0)}r.default=U}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"$root$",file:"app/scripts/controllers/metametrics-controller.ts"}],[92,{"@metamask/base-controller":1476},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.MetaMetricsDataDeletionController=void 0;var n=e("@metamask/base-controller");function s(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(a(e,t))}function a(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}const o="MetaMetricsDataDeletionController",c={metaMetricsDataDeletionId:{persist:!0,anonymous:!0},metaMetricsDataDeletionTimestamp:{persist:!0,anonymous:!0},metaMetricsDataDeletionStatus:{persist:!0,anonymous:!0}};var l=new WeakMap,d=new WeakSet;class u extends n.BaseController{constructor({dataDeletionService:e,messenger:t,state:r}){var n,i;super({messenger:t,metadata:c,name:o,state:{metaMetricsDataDeletionId:null,metaMetricsDataDeletionTimestamp:0,...r}}),s(n=this,i=d),i.add(n),function(e,t,r){s(e,t),t.set(e,r)}(this,l,void 0),function(e,t,r){e.set(a(e,t),r)}(l,this,e),a(d,this,f).call(this)}async createMetaMetricsDataDeletionTask(){const{metaMetricsId:e}=this.messagingSystem.call("MetaMetricsController:getState");if(!e)throw new Error("MetaMetrics ID not found");const t=await i(l,this).createDataDeletionRegulationTask(e);this.update((e=>{e.metaMetricsDataDeletionId=t??null,e.metaMetricsDataDeletionTimestamp=Date.now()})),await this.updateDataDeletionTaskStatus()}async updateDataDeletionTaskStatus(){const e=this.state.metaMetricsDataDeletionId;if(!e)throw new Error("Delete Regulation id not found");const t=await i(l,this).fetchDeletionRegulationStatus(e);this.update((e=>{e.metaMetricsDataDeletionStatus=t??undefined}))}}function f(){this.messagingSystem.registerActionHandler(`${o}:createMetaMetricsDataDeletionTask`,this.createMetaMetricsDataDeletionTask.bind(this)),this.messagingSystem.registerActionHandler(`${o}:updateDataDeletionTaskStatus`,this.updateDataDeletionTaskStatus.bind(this))}r.MetaMetricsDataDeletionController=u}}},{package:"$root$",file:"app/scripts/controllers/metametrics-data-deletion/metametrics-data-deletion.ts"}],[93,{"../../../shared/constants/network":5813,"@metamask/base-controller":1476,"@metamask/keyring-api":2077,"@metamask/multichain-network-controller":2212,"@metamask/utils":2974},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.NetworkOrderController=void 0;var n=e("@metamask/keyring-api"),s=e("@metamask/base-controller"),i=e("@metamask/utils"),a=e("@metamask/multichain-network-controller"),o=e("../../../shared/constants/network");function c(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function l(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}const d={orderedNetworkList:[],enabledNetworkMap:{[i.KnownCaipNamespace.Eip155]:{[o.CHAIN_IDS.MAINNET]:!0,[o.CHAIN_IDS.LINEA_MAINNET]:!0,[o.CHAIN_IDS.BASE]:!0},[i.KnownCaipNamespace.Solana]:{[n.SolScope.Mainnet]:!0}}},u={orderedNetworkList:{persist:!0,anonymous:!0},enabledNetworkMap:{persist:!0,anonymous:!0}};var f=new WeakSet;class p extends s.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:u,name:"NetworkOrderController",state:{...d,...t}}),c(this,f),this.messagingSystem.subscribe("NetworkController:stateChange",(e=>{this.onNetworkControllerStateChange(e)})),this.messagingSystem.subscribe("NetworkController:networkRemoved",(e=>{this.onNetworkRemoved(e.chainId)}))}onNetworkControllerStateChange({networkConfigurationsByChainId:e}){this.update((t=>{const r=Object.keys(e).filter((e=>!o.TEST_CHAINS.includes(e))).map(a.toEvmCaipChainId),s=[n.BtcScope.Mainnet,n.SolScope.Mainnet],i=r.filter((e=>!t.orderedNetworkList.some((({networkId:t})=>t===e)))).map((e=>({networkId:e})));t.orderedNetworkList=t.orderedNetworkList.filter((({networkId:e})=>r.includes(e)||s.includes(e))).concat(i)}));const t=Object.keys(this.state.enabledNetworkMap[i.KnownCaipNamespace.Eip155]);l(f,this,h).call(this,t)}onNetworkRemoved(e){const t=(0,i.isCaipChainId)(e)?e:(0,a.toEvmCaipChainId)(e),{namespace:r}=(0,i.parseCaipChainId)(t);r===i.KnownCaipNamespace.Eip155?this.update((t=>{delete t.enabledNetworkMap[r][e],0===Object.keys(t.enabledNetworkMap[r]).length&&(t.enabledNetworkMap[r]["0x1"]=!0)})):this.update((e=>{delete e.enabledNetworkMap[r][t]}))}updateNetworksList(e){this.update((t=>{t.orderedNetworkList=e.map((e=>({networkId:e})))}))}setEnabledNetworks(e,t){if(!t)throw new Error("networkId is required to set enabled networks");if(!e)throw new Error("chainIds is required to set enabled networks");const r=Array.isArray(e)?e:[e];this.update((e=>{const n=Object.fromEntries(r.map((e=>[e,!0])));e.enabledNetworkMap[t]=n})),l(f,this,h).call(this,r)}}function h(e){var t,r;if(0===e.length)return;const{selectedNetworkClientId:n,networkConfigurationsByChainId:s}=this.messagingSystem.call("NetworkController:getState"),i=null===(t=Object.values(s).find((e=>{var t;return(null===(t=e.rpcEndpoints)||void 0===t||null===(t=t[e.defaultRpcEndpointIndex])||void 0===t?void 0:t.networkClientId)===n})))||void 0===t?void 0:t.chainId,a=Object.values(s).find((t=>t.chainId===e[0])),o=null==a||null===(r=a.rpcEndpoints)||void 0===r||null===(r=r[a.defaultRpcEndpointIndex])||void 0===r?void 0:r.networkClientId;i&&!e.includes(i)&&o&&setTimeout((()=>{this.messagingSystem.call("NetworkController:setActiveNetwork",o)}),0)}r.NetworkOrderController=p}}},{package:"$root$",file:"app/scripts/controllers/network-order.ts"}],[94,{"../../../shared/constants/onboarding":5816,"@metamask/base-controller":1476,loglevel:4920},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getDefaultOnboardingControllerState=r.default=void 0;var n,s=e("@metamask/base-controller"),i=(n=e("loglevel"))&&n.__esModule?n:{default:n},a=e("../../../shared/constants/onboarding");function o(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const c=()=>({seedPhraseBackedUp:null,firstTimeFlowType:null,completedOnboarding:!1});r.getDefaultOnboardingControllerState=c;const l={onboardingTabs:{}},d={seedPhraseBackedUp:{persist:!0,anonymous:!0},firstTimeFlowType:{persist:!0,anonymous:!0},completedOnboarding:{persist:!0,anonymous:!0},onboardingTabs:{persist:!1,anonymous:!1}};class u extends s.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:d,name:"OnboardingController",state:{seedPhraseBackedUp:null,firstTimeFlowType:null,completedOnboarding:!1,...t,...l}}),o(this,"registerOnboarding",(async(e,t)=>{if(this.state.completedOnboarding)return void i.default.debug("Ignoring registerOnboarding; user already onboarded");const{onboardingTabs:r}={...this.state??{}};r&&(r[e]&&r[e]===t||(i.default.debug(`Registering onboarding tab at location '${e}' with tabId '${t}'`),this.update((n=>{n.onboardingTabs={...r,[e]:t}}))))}))}setSeedPhraseBackedUp(e){this.update((t=>{t.seedPhraseBackedUp=e}))}completeOnboarding(){return this.update((e=>{e.completedOnboarding=!0})),!0}setFirstTimeFlowType(e){this.update((t=>{t.firstTimeFlowType=e}))}getIsSocialLoginFlow(){const{firstTimeFlowType:e}=this.state;return e===a.FirstTimeFlowType.socialCreate||e===a.FirstTimeFlowType.socialImport}}r.default=u}}},{package:"$root$",file:"app/scripts/controllers/onboarding.ts"}],[4,{"../../shared/constants/app":5798,"../../shared/constants/errors":5802,"../../shared/constants/metametrics":5810,"../../shared/constants/offscreen-communication":5815,"../../shared/constants/onboarding":5816,"../../shared/lib/get-first-preferred-lang-code":5876,"../../shared/lib/manifestFlags":5878,"../../shared/lib/promise-with-resolvers":5884,"../../shared/modules/browser-runtime.utils":5901,"../../shared/modules/caip-stream":5902,"../../shared/modules/fetch-with-timeout":5908,"../../shared/modules/mv3.utils":5913,"../../shared/modules/object.utils":5915,"../../shared/modules/selectors/networks":5921,"../../test/e2e/background-socket/socket-background-to-mocha":5931,"../../test/e2e/default-fixture":5933,"../../test/stub/keyring-bridge":5940,"./constants/marketing-site-whitelist":6,"./constants/sentry-state":7,"./constants/snaps":8,"./constants/stream":9,"./first-time-state":109,"./fixtures/generate-wallet-state":110,"./lib/CronjobControllerStorageManager":122,"./lib/deep-links/deep-link-router":140,"./lib/deep-links/metrics":141,"./lib/ens-ipfs/setup":146,"./lib/getObjStructure":148,"./lib/migrator":152,"./lib/notification-manager":156,"./lib/safe-reload":184,"./lib/setup-initial-state-hooks":188,"./lib/state-corruption/state-corruption-recovery":199,"./lib/stores/extension-store":201,"./lib/stores/persistence-manager":203,"./lib/stores/read-only-network-store":204,"./lib/stream-utils":205,"./lib/util":226,"./metamask-controller":227,"./migrations":429,"./offscreen":430,"./platforms/extension":431,"@metamask/notification-services-controller":2365,"@metamask/utils":2974,"extension-port-stream":4457,loglevel:4920,"readable-stream":5277,"webextension-polyfill":5774},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.loadStateFromPersistence=Re,r.setupController=De,e("./lib/setup-initial-state-hooks");var n,s=e("readable-stream"),i=X(e("loglevel")),a=X(e("webextension-polyfill")),o=e("@metamask/utils"),c=X(e("extension-port-stream")),l=e("@metamask/notification-services-controller"),d=e("../../shared/lib/promise-with-resolvers"),u=e("../../shared/constants/onboarding"),f=e("../../shared/constants/app"),p=e("../../shared/constants/metametrics"),h=e("../../shared/modules/browser-runtime.utils"),g=e("../../shared/modules/mv3.utils"),m=e("../../shared/modules/object.utils"),E=(e("../../test/e2e/default-fixture"),e("../../test/e2e/background-socket/socket-background-to-mocha"),e("../../shared/constants/offscreen-communication"),e("../../test/stub/keyring-bridge")),_=e("../../shared/modules/selectors/networks"),v=e("../../shared/modules/caip-stream"),y=X(e("../../shared/modules/fetch-with-timeout")),T=e("../../shared/constants/errors"),A=X(e("../../shared/lib/get-first-preferred-lang-code")),I=e("../../shared/lib/manifestFlags"),b=e("./lib/state-corruption/state-corruption-recovery"),P=e("./lib/stores/persistence-manager"),S=X(e("./lib/stores/extension-store")),C=X(e("./lib/stores/read-only-network-store")),M=X(e("./migrations")),w=X(e("./lib/migrator")),N=X(e("./platforms/extension")),O=e("./constants/sentry-state"),R=W(e("./lib/notification-manager")),k=W(e("./metamask-controller")),L=X(e("./lib/getObjStructure")),x=X(e("./lib/ens-ipfs/setup")),D=e("./lib/util"),U=e("./offscreen"),B=e("./lib/stream-utils"),F=(e("./fixtures/generate-wallet-state"),X(e("./first-time-state"))),j=e("./constants/marketing-site-whitelist"),G=e("./constants/stream"),V=e("./constants/snaps"),H=e("./lib/deep-links/deep-link-router"),K=e("./lib/deep-links/metrics"),q=e("./lib/safe-reload"),Y=e("./lib/CronjobControllerStorageManager");function $(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return($=function(e){return e?r:t})(e)}function W(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=$(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var a=s?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(n,i,a):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}function X(e){return e&&e.__esModule?e:{default:e}}const z="#0376C9",Z="#D73847",J=9,Q=!1,ee=Q&&!0!==(null===(n=(0,I.getManifestFlags)().testing)||void 0===n?void 0:n.forceExtensionStore)?new C.default:new S.default,te=new P.PersistenceManager({localStore:ee});global.stateHooks.getMostRecentPersistedState=()=>te.mostRecentRetrievedState,global.logEncryptedVault=()=>{te.logEncryptedVault()};const{sentry:re}=global;let ne={...F.default};const se={[f.ENVIRONMENT_TYPE_POPUP]:!0,[f.ENVIRONMENT_TYPE_NOTIFICATION]:!0,[f.ENVIRONMENT_TYPE_FULLSCREEN]:!0},ie=["trezor-connect"];i.default.setLevel("info",!1);const ae=new N.default,oe=new R.default,ce=(0,D.getPlatform)()===f.PLATFORM_FIREFOX;let le=0,de=!1,ue=!1;const fe={},pe={};let he;const ge={};Q&&(global.stateHooks.metamaskGetState=te.get.bind(te,{validateVault:!1}));const me=new URL("https://metamask.github.io/phishing-warning/v5.0.0/"),Ee=me.toString(),_e=1e3;let ve,ye,Te;function Ae(){const e=(0,d.withResolvers)();ve=e.promise,ye=e.resolve,Te=e.reject}globalThis.stateHooks.onInstalledListener?globalThis.stateHooks.onInstalledListener.then(Fe):a.default.runtime.onInstalled.addListener((function e(t){a.default.runtime.onInstalled.removeListener(e),Fe(t)})),Ae();const Ie=async()=>{const e=await a.default.tabs.query({url:"<all_urls>",windowType:"normal"}).then((e=>((0,h.checkForLastErrorAndLog)(),e))).catch((()=>{(0,h.checkForLastErrorAndLog)()}));for(const t of e)a.default.tabs.sendMessage(t.id,{name:f.EXTENSION_MESSAGES.READY}).then((()=>{(0,h.checkForLastErrorAndLog)()})).catch((()=>{(0,h.checkForLastErrorAndLog)()}))};let be,Pe,Se,Ce;const Me=new b.CorruptionHandler;function we(){const e=(new Date).toISOString();a.default.storage.session.set({timestamp:e})}async function Ne(e){const t=g.isManifestV3?(0,U.createOffscreen)():null,r=await Re(e),n=r.data,s=await(0,A.default)();let o;if(g.isManifestV3){var c;if(!1!==(null===(c=n.PreferencesController)||void 0===c?void 0:c.enableMV3TimestampSave)){const e=2e3;we(),setInterval(we,e)}const e=await a.default.storage.session.get(["isFirstMetaMaskControllerSetup"]);o=(null==e?void 0:e.isFirstMetaMaskControllerSetup)===undefined,await a.default.storage.session.set({isFirstMetaMaskControllerSetup:o})}const l=Q?{keyrings:{trezorBridge:E.FakeTrezorBridge,ledgerBridge:E.FakeLedgerBridge}}:{},d=await async function(){const e=(0,y.default)(),t=V.PREINSTALLED_SNAPS_URLS.map((async t=>{const r=await e(t);if(t.pathname.endsWith(".json.gz")){const e=new DecompressionStream("gzip"),t=r.body.pipeThrough(e);return await new Response(t).json()}return await r.json()}));return Promise.all(t)}(),u=new Y.CronjobControllerStorageManager;await u.init();const{update:f,requestSafeReload:h}=(0,q.getRequestSafeReload)(te);De(n,s,l,o,r.meta,t,d,h,u),he.store.on("update",f),he.store.on("error",(e=>{i.default.error("MetaMask controller.store error:",e),null==re||re.captureException(e)})),function(e){async function t(e,t){try{return await a.default.tabs.update(e,{url:t})}catch(e){return null==re?void 0:re.captureException(e)}}const r=!g.isManifestV3;a.default.webRequest.onBeforeRequest.addListener((n=>{var s,i,o;if(n.tabId===a.default.tabs.TAB_ID_NONE)return{};const{completedOnboarding:c}=e.onboardingController.state;if(!c)return{};if(!e.preferencesController.state.usePhishDetect)return{};if(n.initiator&&"null"!==n.initiator&&new URL(n.initiator).host===me.host)return{};const{hostname:l,href:d,searchParams:u}=new URL(n.url);if(Q&&u.has("IN_TEST_BYPASS_EARLY_PHISHING_DETECTION"))return{};e.phishingController.maybeUpdateState();const f=e.phishingController.isBlockedRequest(n.url);let h,g;if("main_frame"!==n.type&&"sub_frame"!==n.type||(h=e.phishingController.test(n.url)),!(null!==(s=h)&&void 0!==s&&s.result||f.result))return{};let m=l;null!==(i=h)&&void 0!==i&&i.result&&f.result?g=`${h.type} and ${f.type}`:null!==(o=h)&&void 0!==o&&o.result?g=h.type:(g=f.type,m=n.initiator),ce||e.metaMetricsController.trackEvent({event:p.MetaMetricsEventName.PhishingPageDisplayed,category:p.MetaMetricsEventCategory.Phishing,properties:{url:m,referrer:{url:m},reason:g,requestDomain:f.result?l:undefined}},{excludeMetaMetricsId:!0});const E=new URLSearchParams({hostname:l,href:d}),_=new URL(Ee);_.hash=E.toString();const v=_.toString();return r?"main_frame"===n.type?{redirectUrl:v}:(t(n.tabId,v),{cancel:!0}):(t(n.tabId,v),{})}),{urls:["http://*/*","https://*/*","ws://*/*","wss://*/*"]},r?["blocking"]:[])}(he),g.isManifestV3||await async function(){let e;try{const t=new URL(Ee);let r,n;t.hash="#extensionStartup",e=window.document.createElement("iframe"),e.setAttribute("src",t.href),e.setAttribute("sandbox","allow-scripts allow-same-origin");const s=new Promise(((e,t)=>{r=e,n=t}));e.addEventListener("load",r),window.document.body.appendChild(e),setTimeout((()=>n(new Oe)),_e),await s}catch(e){e instanceof Oe?console.warn("Phishing warning page timeout; page not guaranteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{e&&e.remove()}}(),await Ie(),new H.DeepLinkRouter({getExtensionURL:ae.getExtensionURL,getState:he.getState.bind(he)}).on("navigate",(async({url:e,parsed:t})=>{"redirectTo"in t||await he.metaMetricsController.trackEvent((0,K.createEvent)({signature:t.signature,url:e}))})).on("error",(e=>null==re?void 0:re.captureException(e))).install()}a.default.runtime.onConnect.addListener((async(...e)=>{try{await ve,be(...e)}catch(t){null==re||re.captureException(t),(0,T.isStateCorruptionError)(t)&&await Me.handleStateCorruptionError({port:e[0],error:t,database:te,repairCallback:async e=>{Ae(),(0,b.hasVault)(e)?(await je(e),he.onboardingController.setFirstTimeFlowType(u.FirstTimeFlowType.restore)):(await te.reset(),await je(null))}})}})),a.default.runtime.onConnectExternal.addListener((async(...e)=>{await ve,Pe(...e)}));class Oe extends Error{constructor(){super("Timeout failed")}}async function Re(e){var t,r;let n;if(e){n={data:{},meta:{}};for(const t of P.backedUpStateKeys)(0,o.hasProperty)(e,t)&&(n.data[t]=e[t]);(0,o.hasProperty)(e,"meta")&&(0,o.isObject)(e.meta)&&(n.meta=e.meta),"number"!=typeof n.meta.version&&(i.default.error("The `backup`'s `meta.version` property was missing during backup restore."),n.meta.version=155)}else{const e=!0;n=await te.get({validateVault:e})}const s=new w.default({migrations:M.default,defaultVersion:null});s.on("error",(e=>{console.warn(e);const t=(0,L.default)(n);re.captureException(e,{extra:{vaultStructure:t}})})),null!==(t=n)&&void 0!==t&&t.data||null!==(r=n)&&void 0!==r&&r.meta||(n=s.generateInitialState(ne));const a=await s.migrateData(n);if(!a)throw new Error("MetaMask - migrator returned undefined");if(!(0,o.isObject)(a.meta))throw new Error(`MetaMask - migrator metadata has invalid type '${typeof a.meta}'`);if("number"!=typeof a.meta.version)throw new Error(`MetaMask - migrator metadata version has invalid type '${typeof a.meta.version}'`);if(!(0,o.isObject)(a.data))throw new Error(`MetaMask - migrator data has invalid type '${typeof a.data}'`);return te.setMetadata(a.meta),await te.set(a.data),a}function ke(e){const{metaMetricsId:t}=he.metaMetricsController.state;if(!(0,D.shouldEmitDappViewedEvent)(t))return;const r=he.getPermittedAccounts(e).length;if(0===r)return;const n=he.controllerMessenger.call("PreferencesController:getState"),s=Object.keys(n.identities).length;he.metaMetricsController.trackEvent({event:p.MetaMetricsEventName.DappViewed,category:p.MetaMetricsEventCategory.InpageProvider,referrer:{url:e},properties:{is_first_visit:!1,number_of_accounts:s,number_of_accounts_connected:r}},{excludeMetaMetricsId:!0})}function Le(e){if(!e.sender||!e.sender.tab||!e.sender.url)return;const t=e.sender.tab.id,r=new URL(e.sender.url),{origin:n}=r;Object.keys(ge).includes(t)||(ge[t]=n);const s=he.controllerMessenger.call("PermissionController:hasPermissions",n),i="New Tab"!==e.sender.tab.title;s&&i&&ke(n)}function xe(e){const t=[f.ENVIRONMENT_TYPE_POPUP,f.ENVIRONMENT_TYPE_NOTIFICATION,f.ENVIRONMENT_TYPE_FULLSCREEN];!(Object.values(fe).some(Boolean)||de||le>0)&&t.includes(e)&&function(){const{metaMetricsId:e,participateInMetaMetrics:t}=he.metaMetricsController.state;(null!==e||t)&&he.metaMetricsController.trackEvent({event:p.MetaMetricsEventName.AppOpened,category:p.MetaMetricsEventCategory.App})}()}function De(e,t,r,n,o,d,u,h,E){var y;he=new k.default({infuraProjectId:"b6bf7d3508c941499b10025c0776eaf8",showUserConfirmation:Ue,initState:e,initLangCode:t,platform:ae,notificationManager:oe,browser:a.default,getRequestAccountTabIds:()=>pe,getOpenMetamaskTabsIds:()=>fe,overrides:r,isFirstMetaMaskControllerSetup:n,currentMigrationVersion:o.version,featureFlags:{},offscreenPromise:d,preinstalledSnaps:u,requestSafeReload:h,cronjobControllerStorageManager:E}),(0,x.default)({getCurrentChainId:()=>(0,_.getCurrentChainId)({metamask:he.networkController.state}),getIpfsGateway:he.preferencesController.getIpfsGateway.bind(he.preferencesController),getUseAddressBarEnsResolution:()=>he.preferencesController.state.useAddressBarEnsResolution,provider:he.provider}),y=he,global.stateHooks.getSentryAppState=function(){const e=y.memStore.getState();return(0,m.maskObject)(e,O.SENTRY_BACKGROUND_STATE)};const T=()=>le>0||Boolean(Object.keys(fe).length)||de,A=(e,t)=>{if(!1===e)he.onClientClosed();else{if(t===f.ENVIRONMENT_TYPE_FULLSCREEN&&Boolean(Object.keys(fe).length))return;he.onEnvironmentTypeClosed(t)}};function I(e,t){return e>t?`${t}+`:String(e)}function b(){const e=P(),t=function(){try{const{isNotificationServicesEnabled:e,isFeatureAnnouncementsEnabled:t}=he.notificationServicesController.state,r=Object.values(he.notificationServicesController.state.metamaskNotificationsList).filter((e=>e.type===l.NotificationServicesController.Constants.TRIGGER_TYPES.SNAP&&null===e.readDate)).length,n=t?he.notificationServicesController.state.metamaskNotificationsList.filter((e=>!e.isRead&&e.type===l.NotificationServicesController.Constants.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT)).length:0,s=e?he.notificationServicesController.state.metamaskNotificationsList.filter((e=>!e.isRead&&e.type!==l.NotificationServicesController.Constants.TRIGGER_TYPES.FEATURES_ANNOUNCEMENT&&e.type!==l.NotificationServicesController.Constants.TRIGGER_TYPES.SNAP)).length:0;return r+n+s}catch(e){return console.error("Failed to get unread notifications count:",e),0}}();let r="",n=z;e?r=I(e,J):t>0&&(r=I(t,J),n=Z);try{const e={text:r},t={color:n};g.isManifestV3?(a.default.action.setBadgeText(e),a.default.action.setBadgeBackgroundColor(t)):(a.default.browserAction.setBadgeText(e),a.default.browserAction.setBadgeBackgroundColor(t))}catch(e){console.error("Error updating browser badge:",e)}}function P(){try{return he.appStateController.waitingForUnlock.length+he.approvalController.getTotalApprovalCount()}catch(e){return console.error("Failed to get pending approval count:",e),0}}be=e=>{var t;const n=e.name;if(ie.includes(e.name))return;let o=!1;const l=null!==(t=e.sender)&&void 0!==t&&t.url?new URL(e.sender.url):null;if(o=ce?se[n]:(null==l?void 0:l.origin)===`chrome-extension://${a.default.runtime.id}`,o){var d;const t=(null==r||null===(d=r.getPortStream)||void 0===d?void 0:d.call(r,e))||new c.default(e);if(he.isClientOpen=!0,he.setupTrustedCommunication(t,e.sender),xe(n),async function(){try{await he.remoteFeatureFlagController.updateRemoteFeatureFlags()}catch(e){i.default.error("Error initializing remote feature flags:",e)}}(),n===f.ENVIRONMENT_TYPE_POPUP&&(le+=1,(0,s.finished)(t,(()=>{le-=1;const e=T();he.isClientOpen=e,A(e,f.ENVIRONMENT_TYPE_POPUP)}))),n===f.ENVIRONMENT_TYPE_NOTIFICATION&&(de=!0,(0,s.finished)(t,(()=>{de=!1;const e=T();he.isClientOpen=e,A(e,f.ENVIRONMENT_TYPE_NOTIFICATION)}))),n===f.ENVIRONMENT_TYPE_FULLSCREEN){const r=e.sender.tab.id;fe[r]=!0,(0,s.finished)(t,(()=>{delete fe[r];const e=T();he.isClientOpen=e,A(e,f.ENVIRONMENT_TYPE_FULLSCREEN)}))}}else if(l&&l.origin===me.origin&&l.pathname===me.pathname){var u;const t=(null==r||null===(u=r.getPortStream)||void 0===u?void 0:u.call(r,e))||new c.default(e);he.setupPhishingCommunication({connectionStream:t})}else{var p;if(e.sender&&e.sender.tab&&e.sender.url){const t=e.sender.tab.id,r=new URL(e.sender.url),{origin:n}=r;Le(e),e.onMessage.addListener((e=>{e.data&&e.data.method===f.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS&&(pe[n]=t)}))}if(l&&j.COOKIE_ID_MARKETING_WHITELIST_ORIGINS.some((e=>e===l.origin))){var h;const t=(null==r||null===(h=r.getPortStream)||void 0===h?void 0:h.call(r,e))||new c.default(e);he.setUpCookieHandlerCommunication({connectionStream:t})}const t=(null==r||null===(p=r.getPortStream)||void 0===p?void 0:p.call(r,e))||new c.default(e);if(Se(t,e.sender),ce||!g.isManifestV3){const r=(0,B.setupMultiplex)(t);r.ignoreStream(G.METAMASK_EIP_1193_PROVIDER),Ce(r.createStream(G.METAMASK_CAIP_MULTICHAIN_PROVIDER),e.sender)}}},Pe=e=>{var t;const n=(null==r||null===(t=r.getPortStream)||void 0===t?void 0:t.call(r,e))||new c.default(e);if(!e.sender.id){if(ie.includes(e.name))return;Le(e),Ce((0,v.createCaipStream)(n),e.sender)}else Se(n,e.sender)},Se=(e,t)=>{he.setupUntrustedCommunicationEip1193({connectionStream:e,sender:t})},Ce=(e,t)=>{he.setupUntrustedCommunicationCaip({connectionStream:e,sender:t})},null!=r&&r.registerConnectListeners&&r.registerConnectListeners(be,Se),b(),he.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.DECRYPT_MESSAGE_MANAGER_UPDATE_BADGE,b),he.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.ENCRYPTION_PUBLIC_KEY_MANAGER_UPDATE_BADGE,b),he.signatureController.hub.on(k.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,b),he.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.APP_STATE_UNLOCK_CHANGE,b),he.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.APPROVAL_STATE_CHANGE,b),he.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_LIST_UPDATED,b),he.controllerMessenger.subscribe(k.METAMASK_CONTROLLER_EVENTS.METAMASK_NOTIFICATIONS_MARK_AS_READ,b),oe.on(R.NOTIFICATION_MANAGER_EVENTS.POPUP_CLOSED,(({automaticallyClosed:e})=>{e?P()>0&&Ue():(he.signatureController.rejectUnapproved(p.REJECT_NOTIFICATION_CLOSE_SIG),he.decryptMessageController.rejectUnapproved(p.REJECT_NOTIFICATION_CLOSE),he.encryptionPublicKeyController.rejectUnapproved(p.REJECT_NOTIFICATION_CLOSE),he.rejectAllPendingApprovals()),b()})),Object.values(he.snapController.state.snaps).some((e=>!e.preinstalled))&&he.snapController.updateBlockedSnaps()}async function Ue(){const e=await ae.getActiveTabs(),t=Boolean(e.find((e=>fe[e.id]))),r=e.length>0&&e[0].extData&&e[0].extData.indexOf("vivaldi_tab")>-1;if(!ue&&(r||0===le)&&!t){ue=!0;try{const e=he.appStateController.getCurrentPopupId();await oe.showPopup((e=>he.appStateController.setCurrentPopupId(e)),e)}finally{ue=!1}}}const Be=()=>{if(he)return he.metaMetricsController.updateTraits({[p.MetaMetricsUserTrait.InstallDateExt]:(new Date).toISOString().split("T")[0]}),void he.metaMetricsController.addEventBeforeMetricsOptIn({category:p.MetaMetricsEventCategory.App,event:p.MetaMetricsEventName.AppInstalled,properties:{}});setTimeout((()=>{Be()}),500)};function Fe(e){"install"===e.reason?(i.default.debug("First install detected"),Be(),ae.openExtensionInBrowser()):"update"===e.reason&&e.previousVersion&&e.previousVersion!==ae.getVersion()&&async function(){await ve,i.default.debug("Update installation detected"),he.appStateController.setLastUpdatedAt(Date.now())}()}async function je(e){a.default.tabs.onActivated.addListener((e=>{if(he){const{tabId:t}=e,r=ge[t];r&&he.permissionController.state.subjects[r]!==undefined&&ke(r)}}));try{await Ne(e),te.cleanUpMostRecentRetrievedState(),i.default.info("MetaMask initialization complete."),ye()}catch(e){i.default.error(e),Te(e)}}a.default.runtime.onUpdateAvailable.addListener((async function(){await ve,i.default.debug("An update is available"),he.appStateController.setIsUpdateAvailable(!0)})),je(null)}}},{package:"$root$",file:"app/scripts/background.js"}]],[4],{});